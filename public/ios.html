<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>UFO HUB X â€” iOS</title>
  <link rel="stylesheet" href="/styles.css"/>
  <script type="module" src="/app.js"></script>
</head>
<body>
  <div class="container">
    <div class="card">
      <img id="pf" class="profile" alt="UFO HUB X">
      <h1 class="title"><span class="ufo">UFO</span> <span class="hx">HUB X</span></h1>
      <p class="subtitle">iOS Portal â€” à¸£à¸­à¸‡à¸£à¸±à¸š iPhone / iPad</p>

      <div class="row">
        <button id="btnGet" class="btn primary">ðŸ”‘ Get Key</button>
        <button id="btnExtend" class="btn">+5H</button>
        <button id="btnCopy" class="btn">Copy</button>
      </div>

      <p id="keyBox" class="kpill" style="display:none">â€”</p>
      <div id="stat" class="stat" style="display:none">âŒ› à¹€à¸«à¸¥à¸·à¸­à¹€à¸§à¸¥à¸² <b id="remain">â€”</b></div>

      <p class="footer">Need support? <a href="#" id="discord">Join the Discord</a></p>
    </div>
  </div>

  <script type="module">
    import { apiGetKey, apiCheck, apiExtend, copyText, setProfile } from '/app.js';

    const pf = document.getElementById('pf'); setProfile(pf);
    const keyBox = document.getElementById('keyBox');
    const remain = document.getElementById('remain');
    const stat   = document.getElementById('stat');

    let key=null, timer=null;

    async function poll(){
      if(!key) return;
      const j = await apiCheck(key);
      if(j.ok){
        stat.style.display='block';
        remain.textContent = (j.remainingSeconds||0) + 's';
      }
    }
    function startPoll(){ clearInterval(timer); poll(); timer=setInterval(poll, 3000); }

    document.getElementById('btnGet').onclick = async ()=>{
      const j = await apiGetKey();
      if(j.ok){
        key = j.key;
        keyBox.textContent = key;
        keyBox.style.display='inline-block';
        startPoll();
      } else alert(j.message||'Get Key error');
    };
    document.getElementById('btnExtend').onclick = async ()=>{
      if(!key) return alert('à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸„à¸µà¸¢à¹Œ');
      const j = await apiExtend(key);
      if(j.ok) startPoll(); else alert(j.message||'Extend error');
    };
    document.getElementById('btnCopy').onclick = ()=>{ if(key) copyText(key); };
    document.getElementById('discord').onclick = (e)=>{ e.preventDefault(); copyText('https://discord.gg/your-server'); };
  </script>
</body>
</html>
