<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>UFO HUB X — iOS</title>
  <link rel="stylesheet" href="/styles.css"/>
  <script type="module" src="/app.js"></script>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1 class="title"><span class="ufo">UFO</span> HUB X</h1>
      <p class="subtitle">iOS Portal — แนะนำ “เพิ่มลงหน้าจอหลัก” เพื่อใช้งานสะดวก</p>

      <div class="row">
        <button id="btnGet" class="btn primary">🔑 Get Key</button>
        <button id="btnExtend" class="btn">+5H</button>
      </div>

      <p id="keyBox" class="kpill mono" style="display:none"></p>
      <div class="stat" id="stat" style="display:none">
        <span>⌛ เหลือเวลา <b id="remain">—</b></span>
        <button id="btnCopy" class="btn">Copy</button>
      </div>
    </div>
  </div>

  <script type="module">
    import { apiGetKey, apiCheck, apiExtend, copy } from '/app.js';
    let k=null, timer=null;
    const keyBox = document.getElementById('keyBox');
    const remain = document.getElementById('remain');
    const stat   = document.getElementById('stat');

    async function poll(){
      if(!k) return;
      const j = await apiCheck(k);
      if(j.ok){ remain.textContent = j.remainingSeconds+'s'; stat.style.display='flex'; }
    }

    document.getElementById('btnGet').onclick = async ()=>{
      const j = await apiGetKey();
      if(j.ok){ k=j.key; keyBox.textContent=k; keyBox.style.display='inline-flex';
        clearInterval(timer); timer=setInterval(poll, 3000); poll();
      }else alert(j.message||'error');
    };
    document.getElementById('btnExtend').onclick = async ()=>{
      if(!k) return alert('ยังไม่มีคีย์');
      const j = await apiExtend(k);
      if(j.ok) poll(); else alert(j.message||'extend error');
    };
    document.getElementById('btnCopy').onclick = ()=>{ if(k) copy(k); };
  </script>
</body>
</html>
