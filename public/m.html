<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>UFO HUB X тАФ Android</title>
  <link rel="stylesheet" href="/styles.css"/>
  <script type="module" src="/app.js"></script>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1 class="title"><span class="ufo">UFO</span> HUB X</h1>
      <p class="subtitle">Android Portal тАФ 1 р╕Др╕Щр╣Др╕Фр╣Й 1 Key / р╕зр╕▒р╕Щ</p>

      <div class="row">
        <button id="btnGet" class="btn primary">ЁЯФС Get Key</button>
        <button id="btnExtend" class="btn">+5H</button>
      </div>

      <p id="keyBox" class="kpill mono" style="display:none"></p>
      <div class="stat" id="stat" style="display:none">
        <span>тМЫ р╣Ар╕лр╕ер╕╖р╕нр╣Ар╕зр╕ер╕▓ <b id="remain">тАФ</b></span>
        <button id="btnCopy" class="btn">Copy</button>
      </div>

      <p class="footer">р╕лр╕▓р╕Бр╕Др╣Йр╕▓р╕З р╣Гр╕лр╣Йр╕гр╕╡р╣Ар╕Яр╕гр╕Кр╕лр╕Щр╣Йр╕▓</p>
    </div>
  </div>

  <script type="module">
    import { apiGetKey, apiCheck, apiExtend, copy } from '/app.js';
    let lastKey = null, t = null;

    const elKey = document.getElementById('keyBox');
    const elRem = document.getElementById('remain');
    const elStat= document.getElementById('stat');

    async function refresh(){
      if(!lastKey) return;
      const j = await apiCheck(lastKey);
      if(!j.ok){ elRem.textContent='р╕лр╕бр╕Фр╕нр╕▓р╕вр╕╕/р╣Др╕бр╣Ир╕Юр╕Ър╕Др╕╡р╕вр╣М'; return; }
      elRem.textContent = j.remainingSeconds + 's';
      elStat.style.display = 'flex';
    }
    function tick(){
      refresh(); clearInterval(t);
      t = setInterval(refresh, 3000);
    }

    document.getElementById('btnGet').onclick = async ()=>{
      const j = await apiGetKey();
      if(j.ok){
        lastKey = j.key; elKey.textContent = j.key; elKey.style.display='inline-flex';
        tick();
      } else alert(j.message||'error');
    };
    document.getElementById('btnExtend').onclick = async ()=>{
      if(!lastKey) return alert('р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕бр╕╡р╕Др╕╡р╕вр╣М');
      const j = await apiExtend(lastKey);
      if(j.ok) tick(); else alert(j.message||'extend error');
    };
    document.getElementById('btnCopy').onclick = ()=>{ if(lastKey) copy(lastKey); };
  </script>
</body>
</html>
