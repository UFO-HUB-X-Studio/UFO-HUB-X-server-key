<script>
/* UFO HUB X — Smart Desktop (PC) Redirect (v2)
 * - Redirect ผู้ใช้ "เดสก์ท็อป" (Windows / macOS / Linux / ChromeOS) ไป pc.html
 * - แยกจาก iOS/Android อย่างแม่นยำ (iPadOS 13+ ที่ UA = Macintosh แต่มีจอสัมผัส จะไม่นับเป็น Desktop)
 * - รองรับ override ด้วย ?platform=pc|ios|android
 * - คง query และ hash เดิมเมื่อ redirect
 * - กันลูปด้วย sessionStorage และเช็ค path ปัจจุบัน
 * - ข้ามบอท/ API path
 */
(function () {
  try {
    var loc    = window.location;
    var path   = loc.pathname || "/";
    var search = loc.search   || "";
    var hash   = loc.hash     || "";

    // 0) อนุญาต override จาก query (?platform=pc|ios|android)
    var params   = new URLSearchParams(search);
    var override = (params.get("platform") || "").toLowerCase();

    // 1) ข้ามกรณีที่ไม่ควร redirect
    var ua  = navigator.userAgent || "";
    var isBot = /bot|crawler|spider|preview|facebookexternalhit/i.test(ua);
    var isAPI = /^\/api(\/|$)/i.test(path);
    if (isBot || isAPI) return;

    // 2) ตรวจ iOS อย่างถูกต้อง (รวม iPadOS ที่ UA เป็น Macintosh แต่มีจอสัมผัส)
    var maxTouch   = navigator.maxTouchPoints || 0;
    var isiPhone   = /iPhone/i.test(ua);
    var isiPod     = /iPod/i.test(ua);
    var isiPadUA   = /iPad/i.test(ua);
    var isiPadLike = /Macintosh/i.test(ua) && maxTouch > 1; // iPadOS 13+
    var isiOS      = isiPhone || isiPod || isiPadUA || isiPadLike || (navigator.standalone === true);

    // 3) ตรวจ Android
    var isAndroid = /Android/i.test(ua);

    // 4) นิยาม Desktop = ไม่ใช่ iOS และ ไม่ใช่ Android
    var isDesktop = !isiOS && !isAndroid;

    // 5) Override จาก query
    if (override === "pc")      isDesktop = true;
    if (override === "ios")     isDesktop = false;
    if (override === "android") isDesktop = false;

    // 6) กันลูป + อย่า redirect ถ้าอยู่ใน pc.html แล้ว
    var alreadyPC = /\/pc\.html$/i.test(path);
    var loopKey   = "ufo_pc_redirect_done";
    var looped    = sessionStorage.getItem(loopKey) === "1";
    if (!isDesktop || alreadyPC || looped) return;

    // 7) สร้าง URL เป้าหมาย + เก็บ query/hash เดิม (ลบ platform ทิ้งเพื่อความเนียน)
    var base   = path.replace(/\/[^/]*$/, "/");
    var target = base + "pc.html";
    if (params.has("platform")) params.delete("platform");
    var keepQuery = params.toString();
    if (keepQuery) target += "?" + keepQuery;
    if (hash)      target += hash;

    // 8) ตั้งธงกันลูป & redirect
    sessionStorage.setItem(loopKey, "1");
    location.replace(target);
  } catch (e) {
    console.error("[PC redirect] error:", e);
  }
})();
</script>
