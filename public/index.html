<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UFO HUB X - Key System</title>
  <style>
    body {
      margin:0; font-family:sans-serif; color:white;
      background: url("https://cdn.discordapp.com/attachments/1417098355388973154/1417560780110434446/file_00000000385861fab9ee0612cc0dca89.png") no-repeat center center fixed;
      background-size:cover;
    }
    .card {background:rgba(0,0,0,0.7); padding:20px; margin:20px auto; max-width:700px; border-radius:12px;}
    .progress-bar {width:100%; height:8px; background:#333; border-radius:4px; overflow:hidden;}
    .progress-fill {height:100%; background:#00ff88; width:0%;}
    .btn {padding:10px 20px; border:none; border-radius:6px; cursor:pointer; font-weight:bold;}
    .btn-main {background:#00ff88; color:black;}
    .btn-disabled {background:#555; color:#aaa; cursor:not-allowed;}
    .key-row {display:grid; grid-template-columns:2fr 1fr 1fr 1fr; gap:12px; align-items:center; margin-top:12px;}
    .key {font-weight:bold;}
    .status {color:#0f0; font-weight:bold;}
  </style>
</head>
<body>
  <div class="card" style="text-align:center;">
    <img src="https://cdn.discordapp.com/attachments/1417098355388973154/1417560447279960194/20250916_152130.png"
         alt="Logo" style="max-width:160px;border-radius:12px;">
    <h1><span style="color:white;">UFO</span> <span style="color:#00ff88;">HUB X</span></h1>
    <button id="stepBtn" class="btn btn-main">START</button>
    <p id="progressText">Progress: 0/2</p>
    <div class="progress-bar"><div id="bar" class="progress-fill"></div></div>
  </div>

  <div class="card">
    <h2>üîë Your Key</h2>
    <button id="newBtn" class="btn btn-main" disabled>+ GET A NEW KEY</button>
    <div id="row" class="key-row" style="display:none;">
      <div id="keyTxt" class="key"></div>
      <div id="left">--:--:--</div>
      <div id="stat" class="status">ACTIVE</div>
      <div>
        <button id="copyBtn" class="btn">üìã Copy</button>
        <button id="extBtn" class="btn">+5H ‚è©</button>
      </div>
    </div>
  </div>

  <!-- SCRIPT -->
  <script>
    // ===== CONFIG =====
    const REQUIRED_STEPS = 2;
    const OUT_LINK = "https://direct-link.net/1398143/IGoZdaaTcIHW";

    // ===== localStorage keys =====
    const LS_UID   = "ufox_uid_v1";
    const LS_STEPS = "ufox_steps_v1";

    // uid (‡∏Ñ‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πà‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á) ‚Äî ‡πÉ‡∏ä‡πâ‡∏ï‡πà‡∏≠‡∏Ñ‡∏µ‡∏¢‡πå‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ô‡πÄ‡∏î‡∏¥‡∏°
    let uid = localStorage.getItem(LS_UID);
    if (!uid) {
      uid = Math.floor(Math.random()*1e12).toString(36).toUpperCase();
      localStorage.setItem(LS_UID, uid);
    }
    const place = "web";

    // ===== EL =====
    const bar = document.getElementById("bar");
    const stepBtn = document.getElementById("stepBtn");
    const progressText = document.getElementById("progressText");
    const newBtn = document.getElementById("newBtn");
    const row = document.getElementById("row");
    const keyTxt = document.getElementById("keyTxt");
    const leftEl = document.getElementById("left");
    const copyBtn = document.getElementById("copyBtn");
    const extBtn = document.getElementById("extBtn");

    // ‡πÇ‡∏´‡∏•‡∏î progress ‡∏à‡∏≤‡∏Å localStorage
    let steps = Math.max(0, Math.min(REQUIRED_STEPS, parseInt(localStorage.getItem(LS_STEPS) || "0", 10) || 0));
    let current = null;

    function updateStepsUI(){
      const pct = Math.min(100, steps/REQUIRED_STEPS*100);
      bar.style.width = pct + "%";
      progressText.textContent = `Progress: ${steps}/${REQUIRED_STEPS}`;
      if(steps >= REQUIRED_STEPS){
        stepBtn.textContent = "DONE";
        stepBtn.disabled = true;
        newBtn.disabled = false;
      }else{
        stepBtn.textContent = (steps===0 ? "START" : "NEXT");
        stepBtn.disabled = false;
        newBtn.disabled = true;
      }
    }
    updateStepsUI();

    stepBtn.addEventListener("click", ()=>{
      steps = Math.min(REQUIRED_STEPS, steps+1);
      localStorage.setItem(LS_STEPS, String(steps));
      updateStepsUI();
      window.open(OUT_LINK, "_blank");
    });

    window.addEventListener("focus", ()=>{
      const s = Math.max(0, Math.min(REQUIRED_STEPS, parseInt(localStorage.getItem(LS_STEPS) || "0", 10) || 0));
      if (s !== steps) { steps = s; updateStepsUI(); }
    });

    async function api(u){ const r = await fetch(u); if(!r.ok) throw new Error(r.status); return r.json(); }

    function fmt(sec){
      sec = Math.max(0, sec|0);
      const h = Math.floor(sec/3600), m = Math.floor((sec%3600)/60), s = sec%60;
      return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
    }
    function setCurrent(obj){
      current = obj;
      row.style.display = "grid";
      keyTxt.textContent = obj.key;
      tick();
    }
    function tick(){
      if(!current) return;
      const now = Math.floor(Date.now()/1000);
      leftEl.textContent = fmt((current.expires_at|0) - now);
    }
    setInterval(tick, 1000);

    copyBtn.addEventListener("click", ()=>{
      if(!current) return;
      navigator.clipboard?.writeText(current.key);
      copyBtn.textContent = "‚úÖ Copied";
      setTimeout(()=> copyBtn.textContent="üìã Copy", 1200);
    });

    extBtn.addEventListener("click", async ()=>{
      if(!current) return;
      try{
        const j = await api(`/extend?key=${encodeURIComponent(current.key)}&uid=${encodeURIComponent(uid)}`);
        if(j && j.ok && j.expires_at){ setCurrent({key: current.key, expires_at: j.expires_at}); }
      }catch(e){ alert("Extend failed"); }
    });

    newBtn.addEventListener("click", async ()=>{
      if(steps < REQUIRED_STEPS) return;
      try{
        const j = await api(`/getkey?uid=${encodeURIComponent(uid)}&place=${encodeURIComponent(place)}`);
        if(j && j.ok && j.key){
          setCurrent({key:j.key, expires_at:j.expires_at});
          // ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å reset progress ‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ key ‡πÉ‡∏´‡πâ‡∏õ‡∏•‡∏î‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå‡∏Ç‡πâ‡∏≤‡∏á‡∏•‡πà‡∏≤‡∏á:
          // steps = 0;
          // localStorage.setItem(LS_STEPS, "0");
          // updateStepsUI();
        }
      }catch(e){ alert("Get key failed"); }
    });
  </script>
</body>
</html>
