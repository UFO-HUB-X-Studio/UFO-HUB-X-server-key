<!-- … head และ style ทั้งหมดของคุณ (เหมือนเดิม) … -->
<body>
  <div class="container">
    <!-- … HERO / การ์ด / ตาราง … เหมือนเดิม … -->

    <section class="card">
      <div class="head">
        <h1 class="head-title"><span class="ufo">UFO</span> <span class="hubx">HUB X</span></h1>
        <button class="start-btn" id="startBtn">🟢 START</button>
      </div>

      <div class="progress-meta">
        <div id="progressText">Progress: 0/1</div>
        <div id="percentText">0%</div>
      </div>

      <div class="bar-wrap" id="barWrap">
        <div class="bar" id="bar"></div>
        <div class="bar-ufo" id="barUfo" style="left:0px"></div>
      </div>
    </section>

    <!-- … การ์ด Your Key เหมือนเดิม … -->

  </div>

<script>
  /* ================= CONFIG (เพิ่ม) ================= */
  const START_URL       = "https://direct-link.net/1398143/IGoZdaaTcIHW";
  const RETURN_HOST     = "ufo-hub-x-key-umoq.onrender.com";
  const RETURN_FLAG     = "ufo_after_external";
  const PAGE_DELAY_MS   = 5000; // ดีเลย์ 5 วิ ก่อนวิ่งหลอดออโต้หลังกลับมา

  /* ============== ตัวแปรเดิม (คงไว้) ============== */
  const bar       = document.getElementById('bar');
  const barWrap   = document.getElementById('barWrap');
  const barUfo    = document.getElementById('barUfo');
  const pText     = document.getElementById('progressText');
  const percentEl = document.getElementById('percentText');
  const startBtn  = document.getElementById('startBtn');

  let raf = null;
  const LEAD = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--ufo-lead')) || 0;

  function setProgress(p){
    p = Math.max(0, Math.min(100, p));
    bar.style.width = p + '%';

    const barRect  = bar.getBoundingClientRect();
    const wrapRect = barWrap.getBoundingClientRect();
    const tipInside = (barRect.left + barRect.width) - wrapRect.left;

    barUfo.style.left = (tipInside + LEAD) + 'px';

    percentEl.textContent = p.toFixed(0) + '%';
    pText.textContent = 'Progress: ' + (p >= 100 ? '1/1' : '0/1');
  }

  function runProgress(pTarget=100, duration=1200){
    cancelAnimationFrame(raf);
    barUfo.classList.add('on');
    const pStart = parseFloat(bar.style.width) || 0;
    const t0 = performance.now();
    function tick(ts){
      const t = Math.min(1, (ts - t0)/duration);
      const p = pStart + (pTarget - pStart) * t;
      setProgress(p);
      if(t < 1) raf = requestAnimationFrame(tick);
      else if (pTarget === 100) setTimeout(()=>barUfo.classList.remove('on'), 300);
    }
    raf = requestAnimationFrame(tick);
  }

  /* ============== ปุ่ม START (แก้บั๊ก) ============== */
  startBtn.addEventListener('click', ()=>{
    try { localStorage.setItem(RETURN_FLAG, '1'); } catch(e){}
    // ไม่ทำให้หลอดวิ่งในหน้านี้ เพื่อกันเคส "กดย้อนกลับแล้วหลอดขึ้น"
    window.open(START_URL, '_blank'); // เปิดลิงก์ในแท็บใหม่
  });

  /* ======= กลับมาหน้าเราแล้วค่อยวิ่งหลอดหลังดีเลย์ 5 วิ ======= */
  (function autoCompleteIfReturned(){
    const onOurDomain = location.hostname === RETURN_HOST;
    let flag = null;
    try { flag = localStorage.getItem(RETURN_FLAG); } catch(e){}

    if(onOurDomain && flag === '1'){
      try { localStorage.removeItem(RETURN_FLAG); } catch(e){}
      setTimeout(()=>runProgress(100, 1000), PAGE_DELAY_MS);
    }
  })();

  /* ===== preload เดิม (คงไว้) ===== */
  new Image().src = '/img/bg';
  new Image().src = '/img/profile';
  new Image().src = "https://cdn.discordapp.com/attachments/1417098355388973154/1418950206808133672/BackgroundEraser_20250916_190732755.png?ex=68cffbdc&is=68ceaa5c&hm=67ec141db70602a4afe4f884154e87c8055698d901966c7100a6b501c21b5125&";
</script>
</body>
</html>
