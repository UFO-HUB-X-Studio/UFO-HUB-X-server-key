<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <title>UFO HUB X ‚Äî Key Portal</title>
  <meta name="viewport" content="width=1200, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="theme-color" content="#00ff8c" />

  <!-- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL ‡∏£‡∏π‡∏õ (‡πÅ‡∏Å‡πâ‡πÑ‡∏î‡πâ) -->
  <script>
    window.UFO_BG_URL   = "https://cdn.discordapp.com/attachments/1417098355388973154/1417560780110434446/file_00000000385861fab9ee0612cc0dca89.png";
    window.UFO_LOGO_URL = "https://cdn.discordapp.com/attachments/1417098355388973154/1417560447279960194/20250916_152130.png";
  </script>

  <style>
    :root{
      --accent: #00ff8c;
      --bg-dark: #0a1411;
      --card-w : 980px;     /* ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÄ‡∏•‡∏¢‡πå‡πÄ‡∏≠‡∏≤‡∏ï‡πå‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏™‡∏Å‡πå‡∏ó‡πá‡∏≠‡∏õ */
    }
    /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠ */
    body{
      margin:0; min-height:100dvh; color:#e9ffee;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans Thai', sans-serif;
      background:#020b08 center/cover no-repeat fixed;
    }
    /* ‡πÉ‡∏™‡πà‡∏£‡∏π‡∏õ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏î‡πâ‡∏ß‡∏¢ JS ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å URL ‡πÑ‡∏î‡πâ */
    body.bg-ready{ background-image: var(--bg-image); }

    .wrap{ min-height:100dvh; display:flex; align-items:flex-start; justify-content:center; }
    .card{
      width:var(--card-w); max-width:var(--card-w);
      margin:64px auto; padding:20px 24px;
      background:rgba(6,14,12,.88);
      border:2px solid var(--accent);
      border-radius:16px;
      box-shadow: 0 12px 40px rgba(0,0,0,.45), inset 0 0 0 1px rgba(0,255,140,.25);
      backdrop-filter: blur(2px);
    }

    .row{ display:flex; align-items:center; gap:12px; }
    .row.center{ justify-content:center; }
    .spacer{ flex:1; }

    .logo{
      width:56px; height:56px; border-radius:12px; border:1.5px solid rgba(0,255,140,.5);
      background:#08110e center/cover no-repeat;
      box-shadow: inset 0 0 18px rgba(0,255,140,.3);
    }
    .title{
      font-size:28px; font-weight:900; letter-spacing:.2px; display:flex; gap:8px; align-items:center;
    }
    .title .ufo{ color:var(--accent); }
    .title .hubx{ color:#fff; }

    .btn{
      appearance:none; border:1.5px solid var(--accent); border-radius:12px;
      background:#0f1513; color:#e9ffee; padding:12px 16px; font-weight:800;
      transition:.15s ease; cursor:pointer; letter-spacing:.2px;
    }
    .btn.primary{ background:var(--accent); color:#052016; border-color:var(--accent); }
    .btn:active{ transform: translateY(1px); }

    .section{ margin-top:18px; padding-top:18px; border-top:1px solid rgba(255,255,255,.08); }

    /* ‡πÇ‡∏ã‡∏ô START/NEXT */
    .start-box{
      display:flex; align-items:center; gap:12px; justify-content:center;
      padding:14px; background:#0b1310; border:1px solid rgba(0,255,140,.22); border-radius:12px;
    }
    .badge{
      display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:12px;
      background:#0b1310; border:1.5px solid rgba(0,255,140,.35); font-weight:800;
    }

    /* ‡πÅ‡∏™‡∏î‡∏á key ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô */
    .key-pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 14px; border-radius:12px;
      background:#0b1310; border:1.5px solid rgba(0,255,140,.35);
      font-weight:800; letter-spacing:.3px;
    }

    .muted{ color:#b6d1c7; }
    .grid{ display:grid; grid-template-columns: 1fr auto auto; gap:10px; align-items:center; }
    .grid .col-right{ display:flex; gap:10px; }

    /* ‡∏¢‡πà‡∏≠ ‚Äú‡∏ó‡∏±‡πâ‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‚Äù ‡πÄ‡∏ß‡∏•‡∏≤ viewport ‡πÅ‡∏Ñ‡∏ö ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏á‡πÄ‡∏•‡∏¢‡πå‡πÄ‡∏≠‡∏≤‡∏ï‡πå‡πÄ‡∏î‡∏™‡∏Å‡πå‡∏ó‡πá‡∏≠‡∏õ */
    @media (max-width: 1200px){
      .wrap{ align-items:flex-start }
      .card{ transform: scale(.92); transform-origin: top center; }
    }
    @media (max-width: 980px){
      .card{ transform: scale(.84); }
    }
    @media (max-width: 820px){
      .card{ transform: scale(.76); }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">

      <!-- ‡πÅ‡∏ñ‡∏ß‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ + ‡∏õ‡∏∏‡πà‡∏° Copy / +5H (‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏¢‡πâ‡∏≤‡∏¢‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠) -->
      <div class="row">
        <div class="logo" id="logo"></div>
        <div class="title">
          <span class="ufo">UFO</span><span class="hubx">HUB X</span>
        </div>
        <div class="spacer"></div>
        <button id="btnCopy"  class="btn">Copy</button>
        <button id="btnPlus5" class="btn">+5H</button>
      </div>

      <!-- ‡πÇ‡∏ã‡∏ô START / NEXT (2 ‡∏Ç‡∏±‡πâ‡∏ô) -->
      <div class="section">
        <div class="start-box">
          <span class="badge">Progress: <span id="progText">0/2</span></span>
          <button id="btnStart" class="btn primary">START</button>
          <button id="btnNext"  class="btn" style="display:none;">NEXT</button>
          <span class="muted" id="cooldown" style="display:none;">‚è≥ 02:00</span>
        </div>
        <div class="row center" style="margin-top:8px;">
          <span class="muted" id="tipText">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° START ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏Ñ‡∏µ‡∏¢‡πå (‡∏ó‡∏≥ 2 ‡∏Ç‡∏±‡πâ‡∏ô)</span>
        </div>
      </div>

      <!-- ‡πÇ‡∏ã‡∏ô Key ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô + ‡πÄ‡∏ß‡∏•‡∏≤ + ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏£‡∏∞‡∏ó‡∏≥ -->
      <div class="section">
        <div class="grid">
          <div>
            <div class="key-pill">üîë <span id="keyText">-</span></div>
          </div>
          <div class="badge" id="timeLeft">48:00:00</div>
          <div class="col-right">
            <button class="btn" id="btnRefresh">Refresh</button>
            <button class="btn" id="btnOpenApi">Open API</button>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script>
    /* ‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á/‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡πÅ‡∏ö‡∏ö‡πÑ‡∏î‡∏ô‡∏≤‡∏°‡∏¥‡∏Å */
    (function initBG(){
      if (window.UFO_BG_URL){
        document.body.style.setProperty('--bg-image', `url("${window.UFO_BG_URL}")`);
        document.body.classList.add('bg-ready');
      }
      if (window.UFO_LOGO_URL){
        document.getElementById('logo').style.backgroundImage = `url("${window.UFO_LOGO_URL}")`;
      }
    })();

    // ==== ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏´‡∏ô‡πâ‡∏≤ ====
    const state = {
      progress: 0,          // 0 ‚Üí 1 ‚Üí 2
      key: null,
      expireAt: null,       // timestamp (ms)
      cooldownUntil: null,  // timestamp (ms) ‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏Ñ‡∏£‡∏ö 2 ‡∏Ç‡∏±‡πâ‡∏ô‡∏£‡∏≠ 2 ‡∏ô‡∏≤‡∏ó‡∏µ
    };

    const el = {
      progText:  document.getElementById('progText'),
      btnStart:  document.getElementById('btnStart'),
      btnNext:   document.getElementById('btnNext'),
      tip:       document.getElementById('tipText'),
      cooldown:  document.getElementById('cooldown'),
      keyText:   document.getElementById('keyText'),
      timeLeft:  document.getElementById('timeLeft'),
      btnCopy:   document.getElementById('btnCopy'),
      btnPlus5:  document.getElementById('btnPlus5'),
      btnRefresh:document.getElementById('btnRefresh'),
      btnOpenApi:document.getElementById('btnOpenApi'),
    };

    // ==== Utils ====
    function fmtHHMMSS(sec){
      sec = Math.max(0, Math.floor(sec));
      const h = String(Math.floor(sec/3600)).padStart(2,'0');
      const m = String(Math.floor(sec%3600/60)).padStart(2,'0');
      const s = String(sec%60).padStart(2,'0');
      return `${h}:${m}:${s}`;
    }

    function tick(){
      // ‡πÅ‡∏™‡∏î‡∏á cooldown
      if (state.cooldownUntil){
        const left = (state.cooldownUntil - Date.now())/1000;
        if (left > 0){
          el.cooldown.style.display = '';
          el.cooldown.textContent = `‚è≥ ${fmtHHMMSS(left)}`;
        }else{
          el.cooldown.style.display = 'none';
          // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ
          state.progress = 0;
          updateUI();
        }
      }

      // ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ß‡∏•‡∏≤ key
      if (state.expireAt){
        const left = Math.max(0, (state.expireAt - Date.now())/1000);
        el.timeLeft.textContent = fmtHHMMSS(left);
      }
      requestAnimationFrame(tick);
    }

    function updateUI(){
      el.progText.textContent = `${state.progress}/2`;
      if (state.progress === 0){
        el.btnStart.style.display = '';
        el.btnNext.style.display  = 'none';
        el.tip.textContent = '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° START ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏Ñ‡∏µ‡∏¢‡πå (‡∏ó‡∏≥ 2 ‡∏Ç‡∏±‡πâ‡∏ô)';
      }else if (state.progress === 1){
        el.btnStart.style.display = 'none';
        el.btnNext.style.display  = '';
        el.tip.textContent = '‡∏Ç‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà 1 ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏î NEXT ‡∏ï‡πà‡∏≠';
      }else if (state.progress >= 2){
        el.btnStart.style.display = 'none';
        el.btnNext.style.display  = 'none';
        el.tip.textContent = '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß! ‡πÑ‡∏î‡πâ‡∏Ñ‡∏µ‡∏¢‡πå‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤ 48 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á';
      }
      el.keyText.textContent = state.key || '-';
    }

    // ==== ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏ù‡∏±‡πà‡∏á server.js ====
    async function apiGetKey(){
      const r = await fetch('/api/getkey',{ method:'POST' });
      if (!r.ok) throw new Error('getkey failed');
      return r.json(); // { key, expiresAt }
    }
    async function apiCheck(key){
      const r = await fetch(`/api/check/${encodeURIComponent(key)}`);
      if (!r.ok) throw new Error('check failed');
      return r.json(); // { valid, secondsLeft }
    }
    async function apiExtend(key){
      const r = await fetch(`/api/extend/${encodeURIComponent(key)}`,{ method:'POST' });
      if (!r.ok) throw new Error('extend failed');
      return r.json(); // { ok, secondsLeft }
    }

    // ==== ‡∏õ‡∏∏‡πà‡∏° ====
    el.btnStart.addEventListener('click', () => {
      if (state.cooldownUntil && Date.now() < state.cooldownUntil) return;
      state.progress = 1;
      updateUI();
    });

    el.btnNext.addEventListener('click', async () => {
      // ‡∏ó‡∏≥‡∏Ñ‡∏£‡∏ö 2 ‡∏Ç‡∏±‡πâ‡∏ô ‚Üí ‡∏Ç‡∏≠‡∏Ñ‡∏µ‡∏¢‡πå‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å API
      state.progress = 2; updateUI();
      try{
        const data = await apiGetKey();
        state.key = data.key;
        state.expireAt = data.expiresAt; // timestamp ms
        el.keyText.textContent = state.key;

        // ‡∏ó‡∏≥ cooldown 2 ‡∏ô‡∏≤‡∏ó‡∏µ‡πÉ‡∏´‡πâ ‚Äú‡∏Ç‡∏≠‡∏Ñ‡∏µ‡∏¢‡πå‡πÉ‡∏´‡∏°‡πà‚Äù ‡πÑ‡∏î‡πâ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
        state.cooldownUntil = Date.now() + 2*60*1000;
        el.cooldown.style.display = '';
      }catch(e){
        state.progress = 1; updateUI();
        alert('‡∏Ç‡∏≠‡∏Ñ‡∏µ‡∏¢‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
      }
    });

    el.btnCopy.addEventListener('click', async () => {
      if (!state.key) return;
      try{ await navigator.clipboard.writeText(state.key); }catch(e){}
      const old = el.btnCopy.textContent;
      el.btnCopy.textContent = '‚úì Copied';
      setTimeout(()=> el.btnCopy.textContent = old, 1200);
    });

    el.btnPlus5.addEventListener('click', async () => {
      if (!state.key) return;
      try{
        const d = await apiExtend(state.key);
        if (d && d.secondsLeft){
          state.expireAt = Date.now() + d.secondsLeft*1000;
        }
        const old = el.btnPlus5.textContent;
        el.btnPlus5.textContent = '‚úì Extended';
        setTimeout(()=> el.btnPlus5.textContent = old, 1200);
      }catch(e){
        alert('‡∏ï‡πà‡∏≠‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
      }
    });

    el.btnRefresh.addEventListener('click', async () => {
      if (!state.key) return;
      const d = await apiCheck(state.key);
      if (d && typeof d.secondsLeft === 'number'){
        state.expireAt = Date.now() + d.secondsLeft*1000;
      }
    });

    el.btnOpenApi.addEventListener('click', () => {
      window.open('/api/check/demo', '_blank');
    });

    // ‡∏õ‡∏¥‡∏î gesture ‡∏ã‡∏π‡∏°/‡∏´‡∏î ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ layout ‡πÄ‡∏û‡∏µ‡πâ‡∏¢‡∏ô‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏ö‡∏≤‡∏á‡∏£‡∏∏‡πà‡∏ô
    document.addEventListener('gesturestart', e => e.preventDefault());

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
    updateUI(); tick();
  </script>
</body>
</html>
