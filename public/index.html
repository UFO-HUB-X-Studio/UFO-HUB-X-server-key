<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>UFO HUB X ‚Äî Get Key</title>
<style>
  :root{
    --bg:#0a1324; --card:#0e1a30; --card2:#0c182b; --text:#e9f0ff;
    --muted:#97a6c6; --white:#ffffff; --green:#02e3aa; --blue:#1a2b4f;
    --accent:#12f3b3; --accent2:#62ffd5; --row:#0d1a31; --chip:#113222;
  }
  *{box-sizing:border-box}
  body{margin:0;background:#000;color:var(--text);font:14px/1.55 ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto}
  .bg{position:fixed; inset:0;
    background:
      linear-gradient(0deg, rgba(10,19,36,.92), rgba(10,19,36,.78)),
      url('https://cdn.discordapp.com/attachments/1417098355388973154/1417560780110434446/file_00000000385861fab9ee0612cc0dca89.png?ex=68cce81a&is=68cb969a&hm=af9d0c2517a91914f3942f157dedc3324c0e07d3464e2cf57d034dd6cf25b897&');
    background-size:cover; background-position:center;
  }

  /* ‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡πâ‡∏¢‡∏≤‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏õ‡∏∏‡πà‡∏° */
  .wrap.pageTall{position:relative;min-height:1600px;display:flex;justify-content:center;padding:24px 24px 120px;}
  .stack{width:min(1100px,100%);display:flex;flex-direction:column;gap:22px}

  .hero{display:flex;justify-content:center;margin-top:8px}
  .logo{width:280px;height:280px;border-radius:24px;overflow:hidden;display:grid;place-items:center;
    background:#0f1d34;border:1px solid rgba(255,255,255,.06);box-shadow:0 10px 40px rgba(0,0,0,.35)}
  .logo img{width:100%;height:100%;object-fit:cover}
  .brandText{margin-top:8px;text-align:center;font-weight:900;font-size:28px;letter-spacing:.5px}
  .brandText .ufo{color:#ffffff}
  .brandText .hubx{color:var(--green)}

  .card{background:linear-gradient(180deg,var(--card),var(--card2)); border-radius:16px;padding:18px 20px;box-shadow:0 10px 40px rgba(0,0,0,.3)}
  .card--tall{min-height:300px}
  .topRow{display:flex;align-items:center;gap:16px}
  .title{font-weight:900}
  .title .ufo{color:#fff}.title .hubx{color:var(--green)}
  .progressWrap{flex:1;background:#0a1324;height:10px;border-radius:999px;position:relative;margin:0 16px}
  .bar{position:absolute;inset:0;height:100%;width:0;border-radius:999px;background:linear-gradient(90deg,#28ffbf,#70ffe0);transition:width .25s}
  .btn{border:0;border-radius:12px;background:linear-gradient(90deg,#12f3b3,#62ffd5);color:#05251a;
       padding:10px 16px;font-weight:900;cursor:pointer}
  .btn:disabled{opacity:.6;cursor:not-allowed}
  .muted{color:var(--muted)}

  .grid{background:#0b172c;border-radius:14px;padding:12px}
  .head{display:grid;grid-template-columns:1fr 200px 130px 1fr;gap:12px;padding:8px 6px;color:var(--muted);font-weight:800}
  .rows{display:flex;flex-direction:column;gap:10px;max-height:700px;overflow:visible;}
  .row{display:grid;grid-template-columns:1fr 200px 130px 1fr;gap:12px;align-items:center; padding:12px;border-radius:12px;background:var(--row)}
  .mono{font-family:ui-monospace,SFMono-Regular,Consolas,Menlo,Monaco,monospace}
  .pill{display:inline-flex;align-items:center;gap:6px;padding:8px 14px;border-radius:999px;font-weight:900}
  .pill.active{background:var(--chip); color:#86ffc8; border:1px solid #1e5f46}
  .keyCell{display:flex;align-items:center;gap:14px}
  .keyIcon{width:40px;height:40px;border-radius:12px;background:#0f1f3a;display:grid;place-items:center;color:#cfe8ff;font-size:18px}
  .timeGreen{color:#19ff7c; font-weight:900}
  .actWrap{display:flex;gap:8px;flex-wrap:wrap}
  .btnIcon{background:#0f1f3a;color:#cfe8ff}
  .btnSmall{padding:9px 12px;border-radius:10px;font-weight:800;border:0;cursor:pointer}
  .footer{display:flex;gap:10px;justify-content:center;color:var(--muted)}
  .spacer{height:160px}

  /* overlay ‡∏ï‡∏≠‡∏ô‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î */
  .overlay { position: fixed; inset: 0; display: none; background: rgba(5,12,20,.75);
    backdrop-filter: blur(2px); align-items: center; justify-content: center; z-index: 9999; color: #dff7ff; font-weight: 900; letter-spacing: .5px; }
  .overlay .box { background: #0f1d34; border: 1px solid rgba(255,255,255,.08);
    padding: 16px 22px; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,.35); }

  @media (max-width: 640px){
    .head, .row{grid-template-columns:1fr 140px 110px 1fr}
    .keyIcon{width:36px;height:36px}
  }
</style>
</head>
<body>
<div class="bg"></div>

<div class="wrap pageTall">
  <div class="stack">

    <!-- HERO -->
    <div class="hero">
      <div>
        <div class="logo">
          <img src="https://cdn.discordapp.com/attachments/1417098355388973154/1417560447279960194/20250916_152130.png?ex=68cce7cb&is=68cb964b&hm=9050a00523563e88eda267b4271a00ce2024663aae62078987e4401f5e7ce354&" alt="logo"/>
        </div>
        <div class="brandText"><span class="ufo">UFO</span> <span class="hubx">HUB X</span></div>
      </div>
    </div>

    <!-- PROGRESS -->
    <div class="card">
      <div class="topRow">
        <div class="title"><span class="ufo">UFO</span> <span class="hubx">HUB X</span></div>
        <div class="progressWrap"><div class="bar" id="bar"></div></div>
        <button class="btn" id="stepBtn">START</button>
      </div>
      <div class="muted" id="progressText" style="margin-top:10px">Progress: 0/2</div>
    </div>

    <!-- TABLE -->
    <div class="card card--tall">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;flex-wrap:wrap;gap:10px">
        <div class="title" style="font-size:16px">üîë Your Key</div>
        <button class="btn" id="newBtn" disabled>Ôºã GET A NEW KEY</button>
      </div>

      <div class="grid">
        <div class="head"><div>YOUR KEYS (1/6)</div><div>TIME LEFT</div><div>STATUS</div><div>ACTIONS</div></div>

        <div class="rows" id="rows">
          <div class="row" id="row" style="display:none">
            <div class="keyCell">
              <div class="keyIcon">üîë</div>
              <div class="mono" id="keyTxt">UFO-XXXXXXXX-48H</div>
            </div>
            <div class="mono timeGreen" id="left">--:--:--</div>
            <div><span class="pill active">ACTIVE</span></div>
            <div class="actWrap" oncontextmenu="return false">
              <button class="btnSmall btnIcon" id="copyBtn">üìã Copy</button>
              <button class="btnSmall" style="background:#133c2f;color:#baffea" id="extBtn">‚è≥ +48H</button>
              <!-- [ADD] ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏ä‡∏£‡πå‡∏•‡∏¥‡πâ‡∏á‡∏Å‡πå UI -->
              <button class="btnSmall" id="shareBtn" title="Copy UI link">üîó Share</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="spacer"></div>

    <div class="footer">
      <a class="muted" href="https://discord.gg/your-server" target="_blank">Join Discord</a>
      <span>¬∑</span>
      <span class="muted">Complete 2 steps, then get your key.</span>
    </div>

  </div>
</div>

<!-- overlay -->
<div class="overlay" id="overlay"><div class="box">Saving key‚Ä¶ reloading</div></div>

<script>
  /* ===== logic ‡πÄ‡∏î‡∏¥‡∏° + ‡πÄ‡∏û‡∏¥‡πà‡∏° ‚ÄúShare link‚Äù & ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö deep-link ===== */
  const REQUIRED_STEPS = 2;
  const OUT_LINK = "https://direct-link.net/1398143/IGoZdaaTcIHW";

  const LS_UID="ufox_uid_v1", LS_STEPS="ufox_steps_v1",
        LS_CD="ufox_cooldown_until_v1", LS_DONE="ufox_done_lock_until_v1",
        LS_RELOADED="ufox_reloaded_once_v1", LS_LAST_KEY="ufox_last_key_v1",
        LS_LAST_EXP="ufox_last_exp_v1";
  const COOLDOWN_MS = 10*60*1000;

  // reload overlay
  (function(){
    const orig = location.reload.bind(location);
    location.reload = function(){
      try{ localStorage.setItem(LS_RELOADED, String(Date.now())); }catch(e){}
      const ov = document.getElementById("overlay");
      if (ov) ov.style.display = "flex";
      setTimeout(()=>orig(), 1200);
    };
  })();
  (function(){
    const t = parseInt(localStorage.getItem(LS_RELOADED)||"0",10);
    if (t && Date.now()-t<15000) localStorage.removeItem(LS_RELOADED);
  })();

  // uid
  let uid = localStorage.getItem(LS_UID);
  if (!uid) { uid = Math.floor(Math.random()*1e12).toString(36).toUpperCase(); localStorage.setItem(LS_UID, uid); }

  // DOM
  const bar = document.getElementById("bar");
  const stepBtn = document.getElementById("stepBtn");
  const progressText = document.getElementById("progressText");
  const newBtn = document.getElementById("newBtn");
  const row = document.getElementById("row");
  const keyTxt = document.getElementById("keyTxt");
  const leftEl = document.getElementById("left");
  const copyBtn = document.getElementById("copyBtn");
  const extBtn = document.getElementById("extBtn");
  const shareBtn = document.getElementById("shareBtn");

  // storage helpers
  const readSteps=()=>Math.max(0,Math.min(REQUIRED_STEPS, parseInt(localStorage.getItem(LS_STEPS)||"0",10)||0));
  const writeSteps=(n)=>localStorage.setItem(LS_STEPS,String(Math.max(0,Math.min(REQUIRED_STEPS,n))));
  const getCD=()=>parseInt(localStorage.getItem(LS_CD)||"0",10)||0;
  const setCD=(ms)=>localStorage.setItem(LS_CD,String(Date.now()+ms));
  const getDone=()=>parseInt(localStorage.getItem(LS_DONE)||"0",10)||0;
  const setDone=(ms)=>localStorage.setItem(LS_DONE,String(Date.now()+ms));
  const clearDone=()=>localStorage.removeItem(LS_DONE);
  const saveLast=(k,exp)=>{localStorage.setItem(LS_LAST_KEY,k||""); localStorage.setItem(LS_LAST_EXP,String(exp||0));}
  const loadLast=()=>({key: localStorage.getItem(LS_LAST_KEY)||"", exp: parseInt(localStorage.getItem(LS_LAST_EXP)||"0",10)||0});

  let steps = readSteps();
  let current = null;

  function fmtHMS(sec){
    sec = Math.max(0, sec|0);
    const h = Math.floor(sec/3600), m = Math.floor((sec%3600)/60), s = sec%60;
    return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  }
  function fmtMMSS(ms){ const s=Math.max(0,Math.floor(ms/1000)); const m=Math.floor(s/60), ss=s%60; return `${String(m).padStart(2,'0')}:${String(ss).padStart(2,'0')}`;}

  function updateStepsUI(){
    const now = Date.now();
    const lock = getDone();
    if (lock > now){
      bar.style.width = "100%";
      progressText.textContent = `Progress: 2/2`;
      stepBtn.disabled = true;
      stepBtn.textContent = "DONE " + fmtMMSS(lock - now);
      newBtn.disabled = true;
      newBtn.textContent = "Ôºã GET A NEW KEY";
      return;
    }

    const pct = Math.min(100, steps/REQUIRED_STEPS*100);
    bar.style.width = pct + "%";
    progressText.textContent = `Progress: ${steps}/${REQUIRED_STEPS}`;

    if (steps >= REQUIRED_STEPS){
      stepBtn.textContent = "DONE";
      stepBtn.disabled = true;
      const cd = getCD();
      if (cd > now){
        newBtn.disabled = true;
        newBtn.textContent = `‚è≥ WAIT ${fmtMMSS(cd-now)}`;
      }else{
        newBtn.disabled = false;
        newBtn.textContent = "Ôºã GET A NEW KEY";
      }
    }else{
      stepBtn.textContent = (steps===0 ? "START" : "NEXT");
      stepBtn.disabled = false;
      newBtn.disabled = true;
      newBtn.textContent = "Ôºã GET A NEW KEY";
    }
  }
  updateStepsUI();

  stepBtn.addEventListener("click", ()=>{
    if (getDone() > Date.now()) return;
    window.open(OUT_LINK, "_blank");
    steps = Math.min(REQUIRED_STEPS, steps+1);
    writeSteps(steps);
    updateStepsUI();
  });

  function syncBack(){
    const s = readSteps();
    if (s !== steps){ steps = s; updateStepsUI(); }
  }
  window.addEventListener("focus", syncBack);
  document.addEventListener("visibilitychange", syncBack);
  window.addEventListener("pageshow", syncBack);

  async function api(u){ const r = await fetch(u); if(!r.ok) throw new Error(r.status); return r.json(); }

  function setCurrent(obj){
    current = obj;
    row.style.display = "grid";
    keyTxt.textContent = obj.key;
    tick();
  }
  function tick(){
    if(!current) return;
    const now = Math.floor(Date.now()/1000);
    leftEl.textContent = fmtHMS((current.expires_at|0) - now);
  }
  setInterval(tick, 1000);

  copyBtn.addEventListener("click", ()=>{
    if(!current) return;
    navigator.clipboard?.writeText(current.key);
    copyBtn.textContent = "‚úÖ Copied";
    setTimeout(()=> copyBtn.textContent="üìã Copy", 1200);
  });

  extBtn.addEventListener("click", async ()=>{
    if(!current) return;
    try{
      const j = await api(`/extend?key=${encodeURIComponent(current.key)}&uid=${encodeURIComponent(uid)}`);
      if(j && j.ok && j.expires_at){
        setCurrent({ key: current.key, expires_at: j.expires_at });
        saveLast(current.key, j.expires_at);
        updateShareBtn(); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡∏¥‡πâ‡∏á‡∏Å‡πå‡πÅ‡∏ä‡∏£‡πå‡πÉ‡∏´‡πâ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÉ‡∏´‡∏°‡πà
      }
    }catch(e){ alert("Extend failed"); }
  });

  /* ---------- [ADD] SHARE LINK ---------- */
  function makeShareUrl(key, exp){
    const base = location.origin + location.pathname;
    return `${base}#k=${encodeURIComponent(key)}&e=${encodeURIComponent(exp)}`;
  }
  function updateShareBtn(){
    if(!current) { shareBtn.disabled = true; return; }
    shareBtn.disabled = false;
    shareBtn.onclick = async () => {
      const url = makeShareUrl(current.key, current.expires_at|0);
      try{
        await navigator.clipboard?.writeText(url);
        shareBtn.textContent = "‚úÖ Copied Link";
        setTimeout(()=>shareBtn.textContent="üîó Share", 1200);
      }catch(e){
        alert(url); // ‡∏Å‡∏±‡∏ô‡∏Å‡∏£‡∏ì‡∏µ clipboard ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
      }
    };
  }

  // ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡∏µ‡∏¢‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏´‡∏•‡∏±‡∏á‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
  (function(){
    const { key, exp } = loadLast();
    const nowU = Math.floor(Date.now()/1000);
    if (key && exp && exp > nowU) {
      setCurrent({ key, expires_at: exp });
      updateShareBtn();
    }
  })();

  // ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö deep-link: #k=...&e=... ‡∏´‡∏£‡∏∑‡∏≠ ?k=&e=
  (function deepLinkRead(){
    const href = new URL(location.href);
    const hash = new URLSearchParams((href.hash||"").replace(/^#/, ""));
    let k = hash.get("k"), e = parseInt(hash.get("e")||"0",10);
    if(!k){
      k = href.searchParams.get("k");
      e = parseInt(href.searchParams.get("e")||"0",10);
    }
    if (k && e && e > Math.floor(Date.now()/1000)){
      setCurrent({key:k, expires_at:e});
      saveLast(k, e);
      updateShareBtn();
    }
  })();

  // get a new key
  newBtn.addEventListener("click", async ()=>{
    const now = Date.now();
    if (getDone() > now) return;
    if (getCD() > now) return;
    if (steps < REQUIRED_STEPS) return;
    try{
      const j = await api(`/getkey?uid=${encodeURIComponent(uid)}&place=web`);
      if(j && j.ok && j.key){
        setCurrent({ key:j.key, expires_at:j.expires_at });
        saveLast(j.key, j.expires_at);
        updateShareBtn();

        // ‡∏•‡πá‡∏≠‡∏Å DONE + ‡∏Ñ‡∏π‡∏•‡∏î‡∏≤‡∏ß‡∏ô‡πå NEW 10 ‡∏ô‡∏≤‡∏ó‡∏µ
        setDone(COOLDOWN_MS);
        setCD(COOLDOWN_MS);
        steps = REQUIRED_STEPS; writeSteps(steps);

        location.reload();
      }
    }catch(e){ alert("Get key failed"); }
  });
</script>
</body>
</html>
