<!doctype html>
<html lang="en">    
<head>    
<meta charset="utf-8"/>    
<meta name="viewport" content="width=device-width,initial-scale=1"/>    
<title>UFO HUB X ‚Äî Get Key</title>    
<style>    
  :root{    
    --bg:#0a1324; --card:#0e1a30; --card2:#0c182b; --text:#e9f0ff;    
    --muted:#97a6c6; --white:#ffffff; --green:#02e3aa; --blue:#1a2b4f;    
  }    
  *{box-sizing:border-box}    
  body{margin:0;background:#000;color:var(--text);font:14px/1.55 ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto}    
  .bg{position:fixed; inset:0;
    background:linear-gradient(0deg, rgba(10,19,36,.92), rgba(10,19,36,.78)),
               url('https://cdn.discordapp.com/attachments/1417098355388973154/1417560780110434446/file_00000000385861fab9ee0612cc0dca89.png?ex=68cce81a&is=68cb969a&hm=af9d0c2517a91914f3942f157dedc3324c0e07d3464e2cf57d034dd6cf25b897&');
    background-size:cover; background-position:center;}
  .wrap{position:relative;min-height:100dvh;display:flex;justify-content:center;padding:24px}
  .stack{width:min(980px,100%);display:flex;flex-direction:column;gap:18px}

  .hero{display:flex;justify-content:center;margin-top:8px}
  .logo{width:280px;height:280px;border-radius:24px;overflow:hidden;display:grid;place-items:center;
        background:#0f1d34;border:1px solid rgba(255,255,255,.06);box-shadow:0 10px 40px rgba(0,0,0,.35)}
  .logo img{width:100%;height:100%;object-fit:cover}
  .brandText{margin-top:8px;text-align:center;font-weight:900;font-size:28px;letter-spacing:.5px}
  .brandText .ufo{color:#ffffff}
  .brandText .hubx{color:var(--green)}

  .card{background:linear-gradient(180deg,var(--card),var(--card2));
        border-radius:16px;padding:16px 18px;box-shadow:0 10px 40px rgba(0,0,0,.3)}
  .topRow{display:flex;align-items:center;gap:16px}
  .title{font-weight:900}
  .title .ufo{color:#fff}.title .hubx{color:var(--green)}
  .progressWrap{flex:1;background:#0a1324;height:9px;border-radius:999px;position:relative;margin:0 16px}
  .bar{position:absolute;inset:0;height:100%;width:0;border-radius:999px;background:linear-gradient(90deg,#28ffbf,#70ffe0);transition:width .25s}
  .btn{border:0;border-radius:12px;background:linear-gradient(90deg,#12f3b3,#62ffd5);color:#05251a;
       padding:10px 16px;font-weight:900;cursor:pointer}
  .muted{color:var(--muted)}

  .grid{background:#0b172c;border-radius:14px;padding:10px 12px}
  .head{display:grid;grid-template-columns:1fr 160px 120px 140px;gap:12px;padding:8px 6px;color:var(--muted);font-weight:800}
  .row{display:grid;grid-template-columns:1fr 160px 120px 140px;gap:12px;align-items:center;
       padding:12px;border-radius:12px;background:#0d1a31}

  .mono{font-family:ui-monospace,SFMono-Regular,Consolas,Menlo,Monaco,monospace}
  .pill{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;font-weight:800}
  .pill.active{background:rgba(2,227,170,.12);color:var(--green)}
  .btnIcon{background:#0f1f3a;color:#cfe8ff}
  .btnSmall{padding:8px 10px;border-radius:10px;font-weight:800;border:0;cursor:pointer}
  .newKey{display:flex;justify-content:center;margin:12px 0 4px}
  .newKey .btn{background:#0f1f3a;color:#dff7ff}
  .footer{display:flex;gap:10px;justify-content:center;color:var(--muted)}

  /* ===== [ADD] ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏µ‡∏¢‡πå‡πÅ‡∏ö‡∏ö‡∏†‡∏≤‡∏û‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á ===== */
  .keysSubhead{font-size:12px; letter-spacing:.08em; color:var(--muted); margin:-2px 0 10px 2px; font-weight:800}
  .keyCell{display:flex;align-items:center;gap:10px}
  .copyBox{width:56px;height:40px;border-radius:12px;background:#111f35;display:grid;place-items:center;
           border:1px solid rgba(255,255,255,.08)}
  .copyBox svg{width:18px;height:18px;opacity:.9}
  .keyIcon{width:22px;height:22px;display:inline-grid;place-items:center;filter:drop-shadow(0 1px 0 rgba(0,0,0,.4))}
  .keyIcon::before{content:"üóùÔ∏è"; font-size:18px}
  .keyShort{font-weight:900; letter-spacing:.2px}
  .timeGreen{color:#02e3aa; font-weight:900}
  .actionOutline{background:transparent;border:2px solid #1fd3a8;color:#1fd3a8}
  .actionOutline .hour{margin-right:6px}
  .actionOutline:disabled{opacity:.6}
</style>
</head>    
<body>    
<div class="bg"></div>  
<div class="wrap">  
  <div class="stack">

    <!-- HERO -->
    <div class="hero">
      <div>
        <div class="logo">
          <img src="https://cdn.discordapp.com/attachments/1417098355388973154/1417560447279960194/20250916_152130.png?ex=68cce7cb&is=68cb964b&hm=9050a00523563e88eda267b4271a00ce2024663aae62078987e4401f5e7ce354&" alt="logo"/>
        </div>
        <div class="brandText"><span class="ufo">UFO</span> <span class="hubx">HUB X</span></div>
      </div>
    </div>

    <!-- PROGRESS + START/NEXT -->
    <div class="card">
      <div class="topRow">
        <div class="title"><span class="ufo">UFO</span> <span class="hubx">HUB X</span></div>
        <div class="progressWrap"><div class="bar" id="bar"></div></div>
        <button class="btn" id="stepBtn">START</button>
      </div>
      <div class="muted" id="progressText" style="margin-top:10px">Progress: 0/2</div>
    </div>

    <!-- KEY TABLE -->
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <div>
          <div class="title" style="font-size:16px">üîë Your Key</div>
          <!-- [ADD] ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏¢‡πà‡∏≠‡∏¢‡πÅ‡∏ö‡∏ö‡∏†‡∏≤‡∏û -->
          <div class="keysSubhead" id="keysCount">YOUR KEYS (0/6)</div>
        </div>
        <button class="btn" id="newBtn" disabled>Ôºã GET A NEW KEY</button>
      </div>

      <div class="grid">
        <div class="head"><div>KEY</div><div>TIME LEFT</div><div>STATUS</div><div>ACTIONS</div></div>

        <div class="row" id="row" style="display:none">
          <!-- [CHANGED LAYOUT BY ADDING WRAPS ‚Äî ‡πÑ‡∏°‡πà‡∏•‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏° ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏´‡∏∏‡πâ‡∏°/‡πÄ‡∏û‡∏¥‡πà‡∏° span -->
          <div class="keyCell">
            <div class="copyBox" id="copyBox" title="Copy">
              <!-- ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© -->
              <svg viewBox="0 0 24 24" fill="none"><path d="M9 9h7a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2Z" stroke="#cfe8ff" stroke-width="1.6"/><path d="M7 15V6a2 2 0 0 1 2-2h7" stroke="#cfe8ff" stroke-width="1.6"/></svg>
            </div>
            <div class="keyIcon"></div>
            <div>
              <div class="keyShort" id="keyShort">UFO-XXXXXXXX-48H</div>
              <div class="mono muted" id="keyTxt" style="display:none">UFO-XXXXXXXX-48H</div>
            </div>
          </div>

          <div class="mono timeGreen" id="left">--:--:--</div>

          <div><span class="pill active">ACTIVE</span></div>

          <div style="display:flex;gap:8px">
            <button class="btnSmall actionOutline" id="extBtn"><span class="hour">‚åõ</span>+48H</button>
          </div>
        </div>
      </div>
    </div>

    <div class="footer">
      <a class="muted" href="https://discord.gg/your-server" target="_blank">Join Discord</a>
      <span>¬∑</span>
      <span class="muted">Complete 2 steps, then get your key.</span>
    </div>

  </div>
</div>

<!-- overlay ‡πÄ‡∏î‡∏¥‡∏° -->
<div class="overlay" id="overlay">
  <div class="box">Saving key‚Ä¶ reloading</div>
</div>

<script>
  /* ========= ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏≠‡∏à‡∏¥‡∏Å‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° (‡∏°‡∏µ‡πÅ‡∏ï‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°) ========= */

  const REQUIRED_STEPS = 2;
  const OUT_LINK = "https://direct-link.net/1398143/IGoZdaaTcIHW";

  const LS_UID         = "ufox_uid_v1";
  const LS_STEPS       = "ufox_steps_v1";
  const LS_COOLDOWN    = "ufox_cooldown_until_v1";
  const LS_DONE_LOCK   = "ufox_done_lock_until_v1";
  const LS_RELOAD_FLAG = "ufox_reloaded_once_v1";
  const LS_LAST_KEY    = "ufox_last_key_v1";
  const LS_LAST_EXP    = "ufox_last_exp_v1";

  const COOLDOWN_MS = 10 * 60 * 1000;

  (function patchReload(){
    const orig = location.reload.bind(location);
    location.reload = function(){
      try { localStorage.setItem(LS_RELOAD_FLAG, String(Date.now())); } catch(e){}
      const ov = document.getElementById("overlay");
      if (ov) ov.style.display = "flex";
      setTimeout(()=>orig(), 1200);
    };
  })();
  (function preventReloadLoop(){
    const t = parseInt(localStorage.getItem(LS_RELOAD_FLAG) || "0", 10);
    if (t && Date.now() - t < 15000) localStorage.removeItem(LS_RELOAD_FLAG);
  })();

  let uid = localStorage.getItem(LS_UID);
  if (!uid) { uid = Math.floor(Math.random()*1e12).toString(36).toUpperCase(); localStorage.setItem(LS_UID, uid); }
  const place = "web";

  const bar = document.getElementById("bar");
  const stepBtn = document.getElementById("stepBtn");
  const progressText = document.getElementById("progressText");
  const newBtn = document.getElementById("newBtn");
  const row = document.getElementById("row");
  const keyTxt = document.getElementById("keyTxt");
  const keyShortEl = document.getElementById("keyShort"); // [ADD]
  const leftEl = document.getElementById("left");
  const extBtn = document.getElementById("extBtn");
  const copyBox = document.getElementById("copyBox");      // [ADD]
  const keysCountEl = document.getElementById("keysCount");// [ADD]

  function readSteps(){ const n = parseInt(localStorage.getItem(LS_STEPS) || "0", 10); return Number.isFinite(n)? Math.max(0,Math.min(REQUIRED_STEPS,n)) : 0; }
  function writeSteps(n){ localStorage.setItem(LS_STEPS, String(Math.max(0,Math.min(REQUIRED_STEPS,n)))); }

  function getCooldownUntil(){ const v = parseInt(localStorage.getItem(LS_COOLDOWN) || "0", 10); return Number.isFinite(v)? v:0; }
  function setCooldown(ms){ localStorage.setItem(LS_COOLDOWN, String(Date.now() + ms)); }
  function getDoneLockUntil(){ const v = parseInt(localStorage.getItem(LS_DONE_LOCK) || "0", 10); return Number.isFinite(v)? v:0; }
  function setDoneLock(ms){ localStorage.setItem(LS_DONE_LOCK, String(Date.now()+ms)); }
  function clearDoneLock(){ localStorage.removeItem(LS_DONE_LOCK); }

  function saveLastKey(key, exp){ try{ localStorage.setItem(LS_LAST_KEY, key||""); localStorage.setItem(LS_LAST_EXP, String(exp||0)); }catch(e){} }
  function loadLastKey(){ const key = localStorage.getItem(LS_LAST_KEY)||""; const exp = parseInt(localStorage.getItem(LS_LAST_EXP)||"0",10); return {key,exp:Number.isFinite(exp)?exp:0}; }

  // [ADD] ‡∏¢‡πà‡∏≠‡∏Ñ‡∏µ‡∏¢‡πå‡πÅ‡∏ö‡∏ö zZnFp...kwocw
  function shortKey(k){
    if(!k) return "";
    if(k.length <= 10) return k;
    return k.slice(0,5) + "..." + k.slice(-5);
  }

  // [ADD] ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏µ‡∏¢‡πå (‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏≤‡∏°‡∏µ 1 ‡πÅ‡∏ñ‡∏ß‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß) ‚Äì ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Å‡∏±‡∏ö API ‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ
  function updateKeysCount(n){ keysCountEl.textContent = `YOUR KEYS (${n}/6)`; }

  let steps = readSteps();
  let current = null; // {key, expires_at}

  function fmtMMSS(ms){ const s = Math.max(0, Math.floor(ms/1000)); const m = Math.floor(s/60), ss = s%60; return `${String(m).padStart(2,'0')}:${String(ss).padStart(2,'0')}`; }

  function updateStepsUI(){
    const now = Date.now();
    const lockUntil = getDoneLockUntil();

    if (lockUntil > now) {
      bar.style.width = "100%";
      progressText.textContent = `Progress: 2/2`;
      stepBtn.disabled = true; stepBtn.textContent = "DONE " + fmtMMSS(lockUntil-now);
      newBtn.disabled = true; newBtn.textContent = "Ôºã GET A NEW KEY";
      return;
    }

    const pct = Math.min(100, steps/REQUIRED_STEPS*100);
    bar.style.width = pct + "%";
    progressText.textContent = `Progress: ${steps}/${REQUIRED_STEPS}`;

    if(steps >= REQUIRED_STEPS){
      stepBtn.textContent = "DONE"; stepBtn.disabled = true;
      const cdUntil = getCooldownUntil();
      if (cdUntil > now) { newBtn.disabled = true; newBtn.textContent = `‚è≥ WAIT ${fmtMMSS(cdUntil-now)}`; }
      else { newBtn.disabled = false; newBtn.textContent = "Ôºã GET A NEW KEY"; }
    }else{
      stepBtn.textContent = (steps===0 ? "START" : "NEXT"); stepBtn.disabled = false;
      newBtn.disabled = true; newBtn.textContent = "Ôºã GET A NEW KEY";
    }
  }
  updateStepsUI();

  setInterval(()=>{
    const now = Date.now();
    const lockUntil = getDoneLockUntil();
    if (lockUntil && lockUntil <= now) { clearDoneLock(); steps = 0; writeSteps(steps); }
    updateStepsUI();
  }, 1000);

  stepBtn.addEventListener("click", ()=>{
    if (getDoneLockUntil() > Date.now()) return;
    window.open(OUT_LINK, "_blank");
    steps = Math.min(REQUIRED_STEPS, steps+1);
    writeSteps(steps);
    updateStepsUI();
  });

  function syncStepsFromStorage(){ const stored = readSteps(); if (stored !== steps) steps = stored; updateStepsUI(); }
  window.addEventListener("focus", syncStepsFromStorage);
  document.addEventListener("visibilitychange", syncStepsFromStorage);
  window.addEventListener("pageshow", syncStepsFromStorage);

  async function api(u){ const r = await fetch(u); if(!r.ok) throw new Error(r.status); return r.json(); }

  function fmt(sec){
    sec = Math.max(0, sec|0);
    const h = Math.floor(sec/3600), m = Math.floor((sec%3600)/60), s = sec%60;
    return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  }
  function setCurrent(obj){
    current = obj;
    row.style.display = "grid";
    keyTxt.textContent = obj.key;              // ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏ï‡πá‡∏° ‡πÜ (‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà)
    keyShortEl.textContent = shortKey(obj.key);// ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ö‡∏ö‡∏¢‡πà‡∏≠ [ADD]
    tick();
    updateKeysCount(1);                        // [ADD] ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏°‡∏µ 1 ‡∏Ñ‡∏µ‡∏¢‡πå
  }
  function tick(){
    if(!current) return;
    const now = Math.floor(Date.now()/1000);
    leftEl.textContent = fmt((current.expires_at|0) - now);
  }
  setInterval(tick, 1000);

  // copy ‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô
  copyBox.addEventListener("click", ()=>{
    if(!current) return;
    navigator.clipboard?.writeText(current.key);
    copyBox.style.opacity = .7;
    setTimeout(()=> copyBox.style.opacity = 1, 500);
  });

  extBtn.addEventListener("click", async ()=>{
    if(!current) return;
    try{
      const j = await api(`/extend?key=${encodeURIComponent(current.key)}&uid=${encodeURIComponent(uid)}`);
      if(j && j.ok && j.expires_at){ setCurrent({key: current.key, expires_at: j.expires_at}); saveLastKey(current.key, j.expires_at); }
    }catch(e){ alert("Extend failed"); }
  });

  // ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡∏µ‡∏¢‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏´‡∏•‡∏±‡∏á‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
  (function restoreLastKeyOnLoad(){
    const { key, exp } = loadLastKey();
    const nowUnix = Math.floor(Date.now()/1000);
    if (key && exp && exp > nowUnix) { setCurrent({ key, expires_at: exp }); }
    else { updateKeysCount(0); }
  })();

  // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏µ‡∏¢‡πå‡πÉ‡∏´‡∏°‡πà
  newBtn.addEventListener("click", async ()=>{
    const now = Date.now();
    if (getDoneLockUntil() > now) return;
    if (getCooldownUntil() > now) return;
    if(steps < REQUIRED_STEPS) return;

    try{
      const j = await api(`/getkey?uid=${encodeURIComponent(uid)}&place=${encodeURIComponent("web")}`);
      if(j && j.ok && j.key){
        setCurrent({key:j.key, expires_at:j.expires_at});
        saveLastKey(j.key, j.expires_at);

        setDoneLock(COOLDOWN_MS);
        setCooldown(COOLDOWN_MS);

        steps = REQUIRED_STEPS;
        writeSteps(steps);

        location.reload();
      }
    }catch(e){ alert("Get key failed"); }
  });
</script>
</body>
</html>
