<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UFO HUB X</title>
  <style>
    :root{
      --bg:#0b1211;
      --card:#0f1718;
      --card2:#0e1617;
      --text:#e9fffb;
      --muted:#9fffdc;
      --green:#00ffa0;
      --green2:#00ff88;
      --green3:#14ffb1;
      --line:#0a2a25;
      --shadow:0 10px 30px rgba(0,255,160,.12);
      --shadow-strong:0 10px 35px rgba(0,255,160,.25);
      --radius:18px;
      --radius-sm:12px;
      --glow:0 0 0 1px rgba(0,255,160,.15), 0 10px 30px rgba(0,255,160,.12) inset;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif,system-ui,Segoe UI,Roboto,Arial;
      color:var(--text);
      background: var(--bg) center/cover fixed no-repeat;
      /* ‡∏†‡∏≤‡∏û‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ã‡∏ï‡∏ú‡πà‡∏≤‡∏ô JS ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à */
    }
    /* fallback ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ö‡∏ö‡πÑ‡∏•‡πà‡∏™‡∏µ ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏£‡∏≠‡∏£‡∏π‡∏õ */
    body::before{
      content:"";
      position:fixed; inset:0;
      background: radial-gradient(60% 35% at 50% 100%, rgba(0,255,170,.18), transparent 65%),
                  radial-gradient(140% 80% at 120% -20%, rgba(0,255,170,.10), transparent 60%),
                  radial-gradient(140% 80% at -20% 0%, rgba(0,255,170,.10), transparent 60%),
                  #0b1211;
      z-index:-1;
    }

    .wrap{max-width:980px;margin:24px auto;padding:0 16px}

    /* ======= CARD: ‡∏´‡∏±‡∏ß‡∏ö‡∏ô ======= */
    .card{
      background: linear-gradient(180deg, rgba(13,20,20,.92), rgba(13,20,20,.85));
      border-radius:var(--radius);
      padding:18px 18px 16px;
      box-shadow: var(--shadow);
      border:1px solid rgba(0,255,160,.10);
      backdrop-filter: blur(4px);
    }
    .head{
      display:flex; align-items:center; gap:16px;
      margin-bottom:12px;
    }
    .logoBox{
      position:relative; width:72px; height:72px; flex:0 0 72px;
      border-radius:14px; overflow:hidden;
      background:#0d1616; box-shadow: var(--glow);
    }
    /* placeholder ‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ */
    .logoBox::before{
      content:"";
      position:absolute; inset:0;
      background: radial-gradient(circle at 50% 35%, rgba(0,255,160,.25) 0 30%, transparent 31% 100%),
                  linear-gradient(180deg, rgba(0,255,160,.15), transparent 60%);
      filter: blur(6px);
    }
    .logo{width:100%;height:100%;object-fit:cover;display:block;opacity:0;transition:opacity .25s ease}

    .title{font-weight:800; letter-spacing:.5px; display:flex; align-items:baseline; gap:10px; flex-wrap:wrap}
    .title .ufo{color:#fff; font-size:28px}
    .title .hubx{color:var(--green); font-size:28px; text-shadow:0 0 10px rgba(0,255,160,.5)}
    .tag{
      margin-left:auto; font-weight:700; font-size:14px;
      color:#0e1b19; background:linear-gradient(180deg,#60ffc9,#27ffa8);
      padding:8px 14px; border-radius:999px; display:inline-flex; align-items:center; gap:8px;
      box-shadow: var(--shadow-strong);
    }
    .tag::before{content:"üü¢"}

    /* ‡πÅ‡∏ñ‡∏ß progress */
    .progressRow{display:flex; align-items:center; gap:14px}
    .barWrap{
      flex:1; height:16px; border-radius:999px; overflow:hidden;
      background: linear-gradient(180deg,#0a1312,#0f1d1b);
      box-shadow: inset 0 0 0 1px rgba(0,255,160,.15), inset 0 8px 18px rgba(0,255,160,.08);
    }
    .bar{
      height:100%; width:0%;
      background: linear-gradient(90deg,#00ffa0,#00ffd2);
      box-shadow: 0 0 18px rgba(0,255,160,.55);
      transition: width .35s ease;
    }
    .start{
      border:none; border-radius:999px; padding:10px 18px; font-weight:800;
      background: linear-gradient(180deg,#14ffb1,#00e698);
      color:#0a1412; cursor:pointer; box-shadow: var(--shadow-strong);
      display:flex; align-items:center; gap:8px;
    }
    .start:hover{filter:brightness(1.05)}

    .progressText{
      margin-top:8px; text-align:right; color:var(--muted); font-size:14px;
      text-shadow: 0 0 8px rgba(0,255,160,.5);
    }

    /* ======= CARD: ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á (Key) ======= */
    .card2{
      margin-top:18px;
      background: linear-gradient(180deg, rgba(11,18,17,.86), rgba(11,18,17,.80));
      border-radius:var(--radius);
      padding:14px 16px 10px;
      border:1px solid rgba(0,255,160,.10);
      box-shadow: var(--shadow);
      backdrop-filter: blur(4px);
    }
    .rowCap{display:flex; align-items:center; justify-content:space-between; margin-bottom:10px}
    .cap{
      display:flex; align-items:center; gap:10px; font-weight:800; color:var(--muted);
    }
    .cap::before{content:"üîë"}
    .btnNew{
      border:none; border-radius:999px; padding:9px 14px; font-weight:800;
      background:linear-gradient(180deg,#14ffb1,#00e698); color:#0a1412; cursor:pointer;
      box-shadow: var(--shadow-strong);
    }
    .tbl{width:100%; border-collapse:collapse; color:var(--text); font-size:14px}
    .tbl th, .tbl td{padding:12px 10px; text-align:center}
    .tbl thead th{color:var(--muted); font-weight:700; letter-spacing:.5px}
    .tbl tbody tr{background:rgba(0,0,0,.18)}
    .badge{
      background:linear-gradient(180deg,#1affb3,#00e69a);
      color:#0a1412; font-weight:900; border-radius:999px; padding:6px 12px; display:inline-block;
      box-shadow: var(--shadow-strong); font-size:12px;
    }
    .actionRow{display:flex; gap:8px; justify-content:center}
    .btnSm{
      border:1px solid rgba(0,255,160,.25); background:rgba(0,0,0,.35);
      color:var(--text); padding:6px 10px; border-radius:10px; cursor:pointer;
      backdrop-filter: blur(2px);
    }
    .btnSm:hover{background:rgba(0,255,160,.08)}

    /* ‡πÄ‡∏•‡∏¢‡πå‡πÄ‡∏≠‡∏≤‡∏ï‡πå‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
    @media (max-width:640px){
      .title .ufo,.title .hubx{font-size:24px}
      .logoBox{width:64px;height:64px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- ====== CARD ‡∏ö‡∏ô ====== -->
    <section class="card">
      <div class="head">
        <div class="logoBox">
          <img id="logo" class="logo" src="" alt="logo" />
        </div>
        <div class="title">
          <span class="ufo">UFO</span>
          <span class="hubx">HUB X</span>
        </div>
        <button id="startBtn" class="tag">START</button>
      </div>

      <div class="progressRow">
        <div class="barWrap"><div id="bar" class="bar"></div></div>
        <!-- ‡∏õ‡∏∏‡πà‡∏° START ‡∏™‡∏≥‡∏£‡∏≠‡∏á (‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏ó‡∏µ‡πà)
        <button class="start" id="startBtn2">üü¢ START</button> -->
      </div>
      <div id="progText" class="progressText">Progress: 0/1</div>
    </section>

    <!-- ====== CARD ‡∏•‡πà‡∏≤‡∏á (Key) ====== -->
    <section class="card2">
      <div class="rowCap">
        <div class="cap">Your Key</div>
        <button id="btnNew" class="btnNew">+ GET A NEW KEY</button>
      </div>

      <table class="tbl">
        <thead>
          <tr>
            <th>KEY</th>
            <th>TIME LEFT</th>
            <th>STATUS</th>
            <th>ACTIONS</th>
          </tr>
        </thead>
        <tbody id="tbody">
          <!-- ‡πÅ‡∏ñ‡∏ß‡∏Ñ‡∏µ‡∏¢‡πå‡∏à‡∏∞‡πÅ‡∏ó‡∏£‡∏Å‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
        </tbody>
      </table>
    </section>
  </div>

  <script>
    /* ========== ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡πâ‡∏Ç‡∏∂‡πâ‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ========== 
       - ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏ú‡πà‡∏≤‡∏ô proxy ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏Ñ‡∏∏‡∏ì (/img/profile, /img/bg)
       - ‡πÉ‡∏ä‡πâ onload ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πà‡∏≠‡∏¢ ‡πÜ ‡πÄ‡∏ú‡∏¢‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô (‡∏à‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤ "‡πÑ‡∏°‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ")
    */
    (function loadImagesFast(){
      const logo = document.getElementById('logo');
      const bgImg = new Image();
      const bust = Date.now(); // ‡∏Å‡∏±‡∏ô‡πÅ‡∏Ñ‡∏ä

      // ‡πÇ‡∏•‡πÇ‡∏Å‡πâ
      const logoImg = new Image();
      logoImg.onload = () => { logo.src = logoImg.src; logo.style.opacity = 1; }
      logoImg.onerror = () => { /* ‡πÄ‡∏á‡∏µ‡∏¢‡∏ö ‡πÜ ‡πÉ‡∏ä‡πâ placeholder ‡∏ï‡πà‡∏≠ */ }
      logoImg.src = '/img/profile?t=' + bust;

      // ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á
      bgImg.onload = () => {
        document.body.style.backgroundImage = `url('${bgImg.src}')`;
      };
      bgImg.onerror = () => { /* ‡∏Ñ‡∏á fallback gradient ‡πÑ‡∏ß‡πâ */ };
      bgImg.src = '/img/bg?t=' + bust;
    })();

    /* ========== ‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢ ========== */
    const qs = Object.fromEntries(new URLSearchParams(location.search).entries());
    const UID   = qs.uid   || '';   // ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÅ‡∏ô‡∏ö ?uid=...&place=... ‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤
    const PLACE = qs.place || '';

    const tbody = document.getElementById('tbody');
    const progText = document.getElementById('progText');
    const bar = document.getElementById('bar');
    const btnNew = document.getElementById('btnNew');
    const startBtn = document.getElementById('startBtn');

    function fmtLeft(sec){
      if(!sec || sec<=0) return '00:00:00';
      const h = Math.floor(sec/3600);
      const m = Math.floor((sec%3600)/60);
      const s = Math.floor(sec%60);
      return [h,m,s].map(v=>String(v).padStart(2,'0')).join(':');
    }

    function setProgress(cur, total){
      const pct = Math.max(0, Math.min(100, Math.round((cur/total)*100)));
      bar.style.width = pct + '%';
      progText.textContent = `Progress: ${cur}/${total}`;
    }

    /* ========== ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏µ‡∏¢‡πå ========== */
    let current = null; // { key, expires_at }
    let tickTimer = null;

    function renderRow(){
      tbody.innerHTML = '';
      if(!current){ return; }

      const tr = document.createElement('tr');
      const tdKey = document.createElement('td');
      const tdLeft = document.createElement('td');
      const tdStat = document.createElement('td');
      const tdAct = document.createElement('td');

      tdKey.textContent = current.key;
      tdLeft.textContent = '‚Äì:‚Äì:‚Äì';
      const badge = document.createElement('div');
      badge.className = 'badge';
      badge.textContent = 'ACTIVE';
      tdStat.appendChild(badge);

      const act = document.createElement('div');
      act.className = 'actionRow';

      const bCopy = document.createElement('button');
      bCopy.className = 'btnSm';
      bCopy.textContent = 'Copy';
      bCopy.onclick = () => {
        navigator.clipboard?.writeText(current.key);
        bCopy.textContent = 'Copied!';
        setTimeout(()=>bCopy.textContent='Copy', 800);
      };

      const bPlus = document.createElement('button');
      bPlus.className = 'btnSm';
      bPlus.textContent = '+5H ‚è©';
      bPlus.onclick = async () => {
        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏ù‡∏±‡πà‡∏á client ‡πÇ‡∏ä‡∏ß‡πå‡∏™‡∏ß‡∏¢ ‡πÜ (‡∏à‡∏£‡∏¥‡∏á ‡πÜ ‡∏Ñ‡∏ß‡∏£‡πÑ‡∏õ‡∏≠‡∏±‡∏õ‡∏ó‡∏µ‡πà‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå)
        current.expires_at += 5 * 3600;
      };

      act.appendChild(bCopy);
      act.appendChild(bPlus);
      tdAct.appendChild(act);

      tr.appendChild(tdKey);
      tr.appendChild(tdLeft);
      tr.appendChild(tdStat);
      tr.appendChild(tdAct);
      tbody.appendChild(tr);

      // ‡πÄ‡∏Ñ‡∏≤‡∏ô‡∏ï‡πå‡∏î‡∏≤‡∏ß‡∏ô‡πå
      clearInterval(tickTimer);
      tickTimer = setInterval(()=>{
        const left = current.expires_at - Math.floor(Date.now()/1000);
        tdLeft.textContent = fmtLeft(left);
        if(left<=0){
          clearInterval(tickTimer);
          badge.textContent = 'EXPIRED';
          badge.style.background = 'linear-gradient(180deg,#ffb114,#ff7a00)';
        }
      }, 1000);
    }

    async function getKey(){
      if(!UID || !PLACE){
        alert('‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå ?uid=YOUR_UID&place=PLACEID ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô GET A NEW KEY');
        return;
      }
      try{
        const r = await fetch(`/getkey?uid=${encodeURIComponent(UID)}&place=${encodeURIComponent(PLACE)}`);
        const j = await r.json();
        if(j && j.ok){
          current = { key:j.key, expires_at: j.expires_at };
          renderRow();
          // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï progress ‡πÄ‡∏õ‡πá‡∏ô 1/1 ‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏î‡πâ‡∏Ñ‡∏µ‡∏¢‡πå
          setProgress(1,1);
        }else{
          alert('getkey error');
        }
      }catch(e){
        alert('getkey failed');
      }
    }

    async function verify(){
      if(!current || !UID || !PLACE) return;
      try{
        const r = await fetch(`/verify?key=${encodeURIComponent(current.key)}&uid=${encodeURIComponent(UID)}&place=${encodeURIComponent(PLACE)}`);
        const j = await r.json();
        if(j && j.ok && j.valid){
          current.expires_at = j.expires_at || current.expires_at;
          renderRow();
        }
      }catch(e){}
    }

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏•‡∏î
    btnNew.addEventListener('click', getKey);
    startBtn.addEventListener('click', ()=>{ setProgress(1,1); });

    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô UI
    setProgress(0,1);

    // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏Ñ‡∏µ‡∏¢‡πå‡∏°‡∏≤‡∏Å‡∏±‡∏ö URL ‡∏Å‡πá verify ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏¢
    (async ()=>{
      if(qs.key && UID && PLACE){
        current = { key: qs.key, expires_at: Math.floor(Date.now()/1000) + 60 }; // ‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á
        await verify();
      }
    })();
  </script>
</body>
</html>
