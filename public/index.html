<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>UFO HUB X ‚Äî Key Portal</title>
  <meta name="color-scheme" content="dark light" />
  <style>
    :root{
      --bg:#0b0f0c;
      --card:#0f1411;
      --muted:#98a29b;
      --text:#e9fdf3;
      --accent:#00ff8c;           /* ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß UFO */
      --accent-2:#13c28a;
      --danger:#ef4444;
      --warn:#f59e0b;
      --stroke:rgba(0,255,140,.35);
      --shadow: 0 8px 28px rgba(0,255,140,.08);
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font:16px/1.45 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 70% -10%, rgba(0,255,140,.10), transparent 55%),
        radial-gradient(1000px 500px at -20% 110%, rgba(0,255,140,.08), transparent 60%),
        var(--bg);
      display:grid; place-items:center;
      padding:24px;
    }
    .wrap{
      width:min(620px, 100%);
      display:flex; flex-direction:column; gap:16px;
    }
    .brand{
      display:flex; align-items:center; gap:12px; justify-content:center;
    }
    .logo{
      width:44px; height:44px; border-radius:12px;
      background:linear-gradient(135deg, #072, #0b4);
      box-shadow:0 8px 20px rgba(0,255,140,.25) inset;
      display:grid; place-items:center; font-weight:900;
    }
    .title{
      font-weight:900; font-size:24px; letter-spacing:.4px;
    }
    .title .u{color:var(--accent)}
    .title .hx{color:#fff}
    .card{
      background:linear-gradient(180deg, rgba(0,255,140,.05), transparent 32%) , var(--card);
      border:1px solid var(--stroke);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:18px;
    }
    .row{display:flex; gap:10px; align-items:center}
    .row.stretch>*{flex:1}
    .input{
      background:#111715; border:1px solid rgba(0,255,140,.22);
      color:var(--text); border-radius:12px; height:48px; padding:0 14px;
      width:100%; outline:none; transition:.2s border-color,.2s box-shadow;
    }
    .input::placeholder{color:#6e7a73}
    .input:focus{border-color:var(--accent); box-shadow:0 0 0 3px rgba(0,255,140,.18)}
    .btn{
      border:1px solid rgba(0,255,140,.35);
      height:48px; padding:0 16px; border-radius:12px;
      background:#12201a; color:#dff; font-weight:700; letter-spacing:.2px;
      display:inline-flex; gap:10px; align-items:center; justify-content:center;
      cursor:pointer; transition:.18s transform,.18s background,.18s border-color;
    }
    .btn:hover{transform:translateY(-1px); background:#14261d}
    .btn:active{transform:translateY(0)}
    .btn.primary{background:linear-gradient(180deg, var(--accent), var(--accent-2));
      color:#02140b; border-color:transparent}
    .btn.danger{background:#311014; border-color:#4e1b21; color:#ffecec}
    .btn.ghost{background:transparent}

    .hint{color:var(--muted); font-size:13px}
    .status{
      border-radius:12px; padding:12px 14px; background:#0f1714; border:1px dashed rgba(0,255,140,.25);
      display:flex; justify-content:space-between; align-items:center; gap:10px;
    }
    .badge{
      font-size:12px; padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.12);
      background:#0c1310; color:#cfe; letter-spacing:.25px;
    }
    .kline{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace}
    .sep{height:1px; background:linear-gradient(90deg, transparent, rgba(0,255,140,.25), transparent); margin:10px 0}
    .center{display:flex; justify-content:center}
    .toast{
      position:fixed; inset:auto 16px 16px 16px; margin:auto; width:min(520px, 100%);
      background:#0e1512; color:#e8ffee; border:1px solid rgba(0,255,140,.3); border-radius:12px;
      padding:12px 14px; display:none;
    }
    .toast.show{display:block; animation:pop .18s ease-out}
    @keyframes pop{from{transform:translateY(6px); opacity:.0} to{transform:translateY(0); opacity:1}}
  </style>
</head>
<body>
  <div class="wrap">

    <div class="brand">
      <div class="logo">üõ∏</div>
      <div class="title"><span class="u">UFO</span> <span class="hx">HUB X</span></div>
    </div>

    <!-- ‡πÅ‡∏ú‡∏á‡∏Ñ‡∏∏‡∏°‡∏Ñ‡∏µ‡∏¢‡πå -->
    <div class="card" id="panel">
      <div class="row stretch" style="margin-bottom:10px">
        <input id="keyInput" class="input" placeholder="‡πÉ‡∏™‡πà‡∏Ñ‡∏µ‡∏¢‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‚Ä¶" autocomplete="one-time-code" />
        <button id="btnCheck" class="btn">‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏µ‡∏¢‡πå</button>
      </div>

      <div class="row stretch" style="margin-bottom:8px">
        <button id="btnGet" class="btn primary">üîë Get Key</button>
        <button id="btnExtend" class="btn">‚è© +5H (Extend)</button>
        <button id="btnCopy" class="btn ghost">üìã Copy</button>
        <button id="btnClear" class="btn danger">üóë ‡∏•‡∏ö‡∏Ñ‡∏µ‡∏¢‡πå</button>
      </div>

      <div class="status">
        <div>
          <div class="hint">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</div>
          <div id="statText" class="kline">‚Äî</div>
        </div>
        <div class="row">
          <span id="badgeState" class="badge">INIT</span>
          <span id="badgeRemain" class="badge">00:00:00</span>
        </div>
      </div>

      <div class="sep"></div>
      <div class="hint center">‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö: 1 ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå = 1 Key (‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì)</div>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script>
    // ======= CONFIG =======
    // ‡πÉ‡∏ä‡πâ domain ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)
    const API_BASE = location.origin; 
    // ‡∏ñ‡πâ‡∏≤‡∏à‡∏∞‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö domain ‡πÄ‡∏≠‡∏á‡πÉ‡∏´‡πâ‡πÅ‡∏Å‡πâ‡πÄ‡∏õ‡πá‡∏ô:
    // const API_BASE = "https://ufo-hub-x-key.onrender.com";

    const LS_KEY        = "ufox.currentKey";
    const LS_ISSUED_AT  = "ufox.issuedAt";
    const MAX_HOURS     = 48;     // ‡∏≠‡∏≤‡∏¢‡∏∏‡∏Ñ‡∏µ‡∏¢‡πå‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 48 ‡∏ä‡∏°.
    const EXTEND_HOURS  = 5;      // ‡∏Å‡∏î +5H ‡∏ï‡πà‡∏≠‡∏Ñ‡∏£‡∏±‡πâ‡∏á
    const DEVICE_ID     = getDeviceId();  // fingerprint ‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢

    // ======= UI refs =======
    const keyInput   = document.getElementById('keyInput');
    const btnGet     = document.getElementById('btnGet');
    const btnExtend  = document.getElementById('btnExtend');
    const btnCopy    = document.getElementById('btnCopy');
    const btnClear   = document.getElementById('btnClear');
    const btnCheck   = document.getElementById('btnCheck');
    const statText   = document.getElementById('statText');
    const badgeState = document.getElementById('badgeState');
    const badgeRemain= document.getElementById('badgeRemain');
    const toastBox   = document.getElementById('toast');

    // ======= Helpers =======
    function showToast(msg){
      toastBox.textContent = msg;
      toastBox.classList.add('show');
      setTimeout(()=>toastBox.classList.remove('show'), 2200);
    }
    function saveLocal(key){
      localStorage.setItem(LS_KEY, key || "");
      localStorage.setItem(LS_ISSUED_AT, Date.now()+"");
    }
    function loadLocal(){
      const key   = localStorage.getItem(LS_KEY) || "";
      const since = parseInt(localStorage.getItem(LS_ISSUED_AT)||"0",10) || 0;
      return {key, since};
    }
    function fmtRemain(ms){
      if (ms<=0) return "00:00:00";
      const s = Math.floor(ms/1000);
      const h = Math.floor(s/3600); 
      const m = Math.floor((s%3600)/60);
      const ss= (s%60);
      return [h,m,ss].map(x=>String(x).padStart(2,'0')).join(':');
    }
    function setState(text, state="INIT", remainMs=0){
      statText.textContent = text;
      badgeState.textContent = state;
      badgeRemain.textContent= fmtRemain(remainMs);
    }
    function getDeviceId(){
      // ‡∏ü‡∏¥‡∏á‡πÄ‡∏Å‡∏≠‡∏£‡πå‡∏û‡∏£‡∏¥‡πâ‡∏ô‡∏ï‡πå‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢: UA + screen + timezone
      const raw = [
        navigator.userAgent,
        screen.width+"x"+screen.height+"@"+(screen.pixelRatio||1),
        Intl.DateTimeFormat().resolvedOptions().timeZone||""
      ].join("|");
      return btoa(unescape(encodeURIComponent(raw))).slice(0,32);
    }

    // ======= API wrappers =======
    async function apiGetKey(){
      const res = await fetch(`${API_BASE}/api/getkey`, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ deviceId: DEVICE_ID })
      });
      if(!res.ok) throw new Error(await res.text());
      return res.json();
    }
    async function apiCheck(key){
      const res = await fetch(`${API_BASE}/api/check/${encodeURIComponent(key)}?deviceId=${encodeURIComponent(DEVICE_ID)}`);
      if(!res.ok) throw new Error(await res.text());
      return res.json();
    }
    async function apiExtend(key){
      const res = await fetch(`${API_BASE}/api/extend/${encodeURIComponent(key)}`, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ hours: EXTEND_HOURS, deviceId: DEVICE_ID })
      });
      if(!res.ok) throw new Error(await res.text());
      return res.json();
    }

    // ======= UI actions =======
    btnGet.addEventListener('click', async ()=>{
      try{
        btnGet.disabled = true;
        const { ok, key, message } = await apiGetKey();
        if(!ok){ showToast(message||"‡∏≠‡∏≠‡∏Å‡∏Ñ‡∏µ‡∏¢‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"); return; }
        keyInput.value = key;
        saveLocal(key);
        showToast("‡πÑ‡∏î‡πâ‡∏Ñ‡∏µ‡∏¢‡πå‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡πâ‡∏ß ‚úÖ");
        await checkNow();
      }catch(e){
        console.error(e);
        showToast("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏Ç‡∏ì‡∏∞‡∏≠‡∏≠‡∏Å‡∏Ñ‡∏µ‡∏¢‡πå");
      }finally{ btnGet.disabled = false; }
    });

    btnCheck.addEventListener('click', checkNow);
    keyInput.addEventListener('keydown', e=>{
      if(e.key==='Enter') checkNow();
    });

    async function checkNow(){
      const key = keyInput.value.trim();
      if(!key){ showToast("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ñ‡∏µ‡∏¢‡πå‡∏Å‡πà‡∏≠‡∏ô"); return; }
      try{
        btnCheck.disabled = true;
        const { ok, valid, remainingMs, message, ownerDevice } = await apiCheck(key);
        if(!ok){ showToast(message||"‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏µ‡∏¢‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"); setState("Error", "ERR"); return; }

        if(!valid){
          setState(message||"‡∏Ñ‡∏µ‡∏¢‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏", "INVALID", 0);
          showToast("‡∏Ñ‡∏µ‡∏¢‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á/‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ ‚ùå");
          return;
        }

        // ‡∏ñ‡πâ‡∏≤ key ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
        if(ownerDevice && ownerDevice !== DEVICE_ID){
          setState("‡∏Ñ‡∏µ‡∏¢‡πå‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏≠‡∏∑‡πà‡∏ô", "LOCKED", 0);
          showToast("‡∏Ñ‡∏µ‡∏¢‡πå‡∏ô‡∏µ‡πâ‡∏•‡πá‡∏≠‡∏Ñ‡∏Å‡∏±‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏≠‡∏∑‡πà‡∏ô üîí");
          return;
        }

        saveLocal(key);
        setState("‡∏Ñ‡∏µ‡∏¢‡πå‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô", "ACTIVE", remainingMs);
        showToast("‡∏Ñ‡∏µ‡∏¢‡πå‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ ‚úÖ");
      }catch(e){
        console.error(e);
        showToast("‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏µ‡∏¢‡πå‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß");
      }finally{ btnCheck.disabled = false; }
    }

    btnExtend.addEventListener('click', async ()=>{
      const key = keyInput.value.trim();
      if(!key){ showToast("‡πÉ‡∏™‡πà‡∏Ñ‡∏µ‡∏¢‡πå‡∏Å‡πà‡∏≠‡∏ô"); return; }
      try{
        btnExtend.disabled = true;
        const { ok, remainingMs, message } = await apiExtend(key);
        if(!ok){ showToast(message||"‡∏¢‡∏∑‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"); return; }
        setState("‡∏ï‡πà‡∏≠‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡πâ‡∏ß +5 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á", "ACTIVE", remainingMs);
        showToast("‡∏¢‡∏∑‡∏î‡πÄ‡∏ß‡∏•‡∏≤ +5H ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚è©");
      }catch(e){
        console.error(e);
        showToast("‡∏¢‡∏∑‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
      }finally{ btnExtend.disabled = false; }
    });

    btnCopy.addEventListener('click', async ()=>{
      const key = keyInput.value.trim();
      if(!key){ showToast("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏µ‡∏¢‡πå‡πÉ‡∏´‡πâ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å"); return; }
      try{
        await navigator.clipboard.writeText(key);
        showToast("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ñ‡∏µ‡∏¢‡πå‡πÅ‡∏•‡πâ‡∏ß üìã");
      }catch{
        showToast("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
      }
    });

    btnClear.addEventListener('click', ()=>{
      localStorage.removeItem(LS_KEY);
      localStorage.removeItem(LS_ISSUED_AT);
      keyInput.value = "";
      setState("‡∏•‡∏ö‡∏Ñ‡∏µ‡∏¢‡πå‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß", "CLEARED", 0);
      showToast("‡∏•‡∏ö‡∏Ñ‡∏µ‡∏¢‡πå‡πÅ‡∏•‡πâ‡∏ß");
    });

    // ======= boot =======
    (function init(){
      const {key} = loadLocal();
      if(key){ keyInput.value = key; }
      setState("‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô", "READY", 0);
    })();
  </script>
</body>
</html>
