<!-- ========= ADD-ONLY PATCH: Border always visible + Progress label fix + UFO sync ========= -->
<style>
  /* กันกรณีมี transition/opacity จากคลาสเดิม */
  .force-visible { opacity: 1 !important; pointer-events: auto !important; }
  /* ตอนยังไม่เริ่มวิ่ง ให้ซ่อน UFO ไว้ก่อน */
  .ufo-hidden-init { opacity: 0 !important; }
</style>

<script>
(function () {
  // ====== อ้างอิง element หลัก ======
  const progressMeta = document.getElementById('progressMeta');
  const barWrap      = document.getElementById('barWrap');
  const bar          = document.getElementById('bar');
  const barUfo       = document.getElementById('barUfo');
  const pText        = document.getElementById('progressText');
  const percentEl    = document.getElementById('percentText');

  // ====== 1) โชว์ "กรอบดาวน์โหลด" ตั้งแต่แรก (ตรงตำแหน่งลูกศร) ======
  if (progressMeta) {
    progressMeta.classList.remove('is-hidden');
    progressMeta.classList.add('force-visible');
  }
  if (barWrap) {
    barWrap.classList.remove('is-hidden');
    barWrap.classList.add('force-visible');
  }

  // ====== 2) ล็อกหัวข้อให้เป็น Progress: 1/1 ตั้งแต่เริ่ม ======
  if (pText) pText.textContent = 'Progress: 1/1';

  // ====== 3) ตั้งรูปยาน UFO แบบลิงก์เต็ม + ซ่อนจนกว่าจะมี progress จริง ======
  const UFO_URL_EXACT = "https://cdn.discordapp.com/attachments/1417098355388973154/1418950206808133672/BackgroundEraser_20250916_190732755.png?ex=68cffbdc&is=68ceaa5c&hm=67ec141db70602a4afe4f884154e87c8055698d901966c7100a6b501c21b5125&";
  if (barUfo) {
    // ใช้ภาพตามที่ให้ และซ่อนระหว่างยังไม่มี progress
    barUfo.style.backgroundImage = `url("${UFO_URL_EXACT}")`;
    barUfo.classList.add('ufo-hidden-init');
    // วาง UFO ไว้ตรงหัวแท่ง (ให้เห็นขอบชัดเวลายังไม่วิ่ง)
    requestAnimationFrame(()=>{
      const half = (barUfo.offsetWidth || 50)/2;
      barUfo.style.left = (half + 2) + 'px';
    });
    // พรีโหลดกันกระพริบ
    const _img = new Image(); _img.src = UFO_URL_EXACT;
  }

  // ====== 4) ครอบฟังก์ชัน setProgress เดิม (ไม่ลบของเก่า) ======
  const _origSet = window.setProgress;
  window.setProgress = function(p){
    // ถ้าโปรเจ็กต์เดิมมี setProgress ให้เรียกก่อน
    if (typeof _origSet === 'function') {
      _origSet(p);
    } else {
      // เผื่อกรณีไม่มีของเดิม: อัปเดตความกว้างเองแบบเบา ๆ
      if (bar) {
        const safe = Math.max(0, Math.min(100, Number(p)||0));
        bar.style.width = safe + '%';
      }
      if (percentEl) percentEl.textContent = (Math.max(0, Math.min(100, Number(p)||0))).toFixed(0) + '%';
    }

    // ล็อกข้อความหัวข้อให้เป็น 1/1 เสมอ (กันการเปลี่ยนกลับ 0/1)
    if (pText) pText.textContent = 'Progress: 1/1';

    // ซิงก์การแสดง UFO: p>0 โผล่พร้อมหลอด, p>=100 ซ่อน (หน่วงนิดให้เห็นจบ)
    if (barUfo) {
      const val = Number(p) || 0;
      if (val > 0 && val < 100) {
        barUfo.classList.remove('ufo-hidden-init');
        barUfo.classList.add('on');
      } else if (val >= 100) {
        setTimeout(()=>{ barUfo.classList.remove('on'); }, 300);
      } else {
        // p == 0
        barUfo.classList.add('ufo-hidden-init');
        barUfo.classList.remove('on');
      }
    }
  };

  // ====== 5) กันเคสหน้าเพิ่งโหลด: ทำให้ค่าปัจจุบันสอดคล้องกับ UI ======
  // ให้ setProgress ถูกเรียกอย่างน้อยหนึ่งครั้งด้วยค่าปัจจุบัน (0) เพื่อให้ logic ด้านบนทำงาน
  window.setProgress(parseFloat(bar?.style?.width) || 0);
})();
</script>
<!-- ========= /ADD-ONLY PATCH ========= -->
