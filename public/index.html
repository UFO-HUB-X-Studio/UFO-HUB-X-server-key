<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>UFO HUB X ‚Äî Get Key</title>

<!-- ========== THEME ========== -->
<style>
  :root{
    --bg:#0b0f12;
    --card:#111827cc;                 /* ‡∏Å‡∏£‡∏≠‡∏ö‡πÄ‡∏Ç‡πâ‡∏°‡πÇ‡∏õ‡∏£‡πà‡∏á */
    --stroke:#1f2a30;
    --muted:#9fb0b7;
    --text:#e9f1f3;
    --accent:#00ff8c;                 /* ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÄ‡∏≠‡∏Å‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå */
    --accent-2:#2ad39a;
    --ok:#21d28b;
    --warn:#f6c14c;
    --bad:#e35b62;
    --pill:#1e293b;
    --shadow:0 12px 30px rgba(0,0,0,.35);
    --radius:18px;
    --logo-url:url("https://cdn.discordapp.com/attachments/1417098355388973154/1417560447279960194/20250916_152130.png?ex=68caed8b&is=68c99c0b&hm=d765fd0dd2ea7abcf19570afee5aee70c89dc0c5c83a337454d4f5a1aa7d0f32&");
    --bg-url:url("https://cdn.discordapp.com/attachments/1417098355388973154/1417560780110434446/file_00000000385861fab9ee0612cc0dca89.png?ex=68caedda&is=68c99c5a&hm=2638f6b576104b88e472c7f13517e8fa83d04ae63b785255a821d5c685daeaf9&");
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Arial;
    color:var(--text);
    background:#000;
    background-image:var(--bg-url);
    background-size:cover; background-position:center; background-attachment:fixed;
  }
  .overlay{position:fixed; inset:0; background:linear-gradient(180deg,#0007,#000c)}
  .wrap{position:relative; z-index:1; min-height:100%; padding:18px; display:grid; place-items:start center}

  /* ======= NAV (‡∏ö‡∏≤‡∏£‡πå‡∏ö‡∏ô) ======= */
  .nav{
    width:min(1000px,100%);
    height:64px;
    background:#1f2937cc;
    border:1px solid #2b3a42;
    border-radius:16px;
    box-shadow:var(--shadow);
    padding:0 18px;
    display:flex; align-items:center; justify-content:space-between;
    margin:8px 0 16px;
  }
  .nav .brand{display:flex; align-items:center; gap:12px}
  .nav .brand .logo{
    width:40px; height:40px; border-radius:12px; border:1px solid #00ff8c66;
    background:var(--logo-url) center/cover no-repeat;
  }
  .nav .brand .name{font-weight:800; letter-spacing:.3px; color:#dbe8ee}
  .nav .menu{width:40px; height:40px; border-radius:10px; border:1px solid #30414a; display:grid; place-items:center; color:#9fb0b7}

  /* ======= CARD ‡∏´‡∏•‡∏±‡∏Å ======= */
  .card{
    width:min(1000px,100%);
    background:var(--card);
    border:1px solid #2b3a42;
    border-radius:var(--radius);
    backdrop-filter:blur(6px);
    box-shadow:var(--shadow);
    overflow:hidden;
  }
  .card .inner{padding:18px}

  /* Header ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î */
  .hdr{
    display:flex; align-items:center; justify-content:space-between; gap:16px;
    padding:8px 10px 14px; border-bottom:1px solid #ffffff14;
  }
  .hdr .ttl{font-weight:900; font-size:22px; letter-spacing:.2px}
  .ttl .ufo{color:var(--accent)} .ttl .hub{color:#fff}

  /* ‡πÅ‡∏ñ‡∏ß progress */
  .progressRow{
    position:relative;
    display:grid; grid-template-columns:1fr auto; gap:16px; align-items:center;
    background:#0f172acc; border:1px solid var(--stroke);
    border-radius:14px; padding:14px 14px 14px 16px;
    margin-top:16px;
  }
  .barMeta{display:flex; justify-content:space-between; color:var(--muted); font-size:14px; margin-bottom:6px}
  .bar{height:10px; background:#0b1a20; border:1px solid #17333a; border-radius:999px; overflow:hidden}
  .bar>span{display:block; height:100%; width:0%; background:linear-gradient(90deg,var(--accent),#76ffd1); transition:width .25s}
  .timerPill{
    display:inline-flex; align-items:center; gap:8px; padding:10px 14px;
    background:#0b1220; border:1px solid #244051; color:#b6d7f5; border-radius:12px; font-weight:700;
  }

  /* ‡∏õ‡∏∏‡πà‡∏° */
  .btn{
    border:none; border-radius:12px; padding:12px 18px; font-weight:800; cursor:pointer;
    color:#0b1115; background:var(--accent); transition:transform .06s, opacity .2s, background .2s;
    display:inline-flex; align-items:center; justify-content:center; gap:10px;
  }
  .btn:active{transform:translateY(1px)}
  .btn.secondary{background:#0f1620; color:#e9f1f3; border:1px solid var(--accent)}
  .btn.dim{opacity:.55; pointer-events:none}

  /* ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏µ‡∏¢‡πå */
  .section{margin-top:16px; background:#0f172acc; border:1px solid var(--stroke); border-radius:14px; padding:12px}
  .secHead{display:flex; align-items:center; justify-content:space-between; padding:6px 6px 10px; border-bottom:1px solid #ffffff12; margin-bottom:6px}
  .secTitle{font-weight:800; color:#d9e6ea}
  table{width:100%; border-collapse:collapse}
  th,td{padding:12px 10px; border-bottom:1px solid #ffffff12; text-align:center}
  th{color:#9db2b9; text-transform:uppercase; letter-spacing:.4px; font-size:12px}
  .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;}
  .actions{display:flex; justify-content:center; gap:10px}
  .badge{padding:6px 10px; border-radius:999px; font-size:12px; font-weight:800; display:inline-block}
  .ok{background:#0c3226; border:1px solid var(--accent-2); color:#69f5c6}
  .bad{background:#34151a; border:1px solid #e45865; color:#ff8ea0}

  /* mobile */
  @media (max-width:640px){
    .nav{height:56px}
    .hdr .ttl{font-size:18px}
    .progressRow{grid-template-columns:1fr}
    th:nth-child(2), td:nth-child(2){display:none} /* ‡∏ã‡πà‡∏≠‡∏ô Full Key ‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
  }
</style>
</head>
<body>
<div class="overlay"></div>

<!-- NAV -->
<div class="wrap">
  <div class="nav">
    <div class="brand">
      <div class="logo" aria-label="UFO HUB X"></div>
      <div class="name">Luarmor</div>
    </div>
    <div class="menu">‚â°</div>
  </div>

  <!-- CARD -->
  <div class="card">
    <div class="inner">
      <div class="hdr">
        <div class="ttl"><span class="ufo">UFO</span> <span class="hub">HUB X</span></div>
      </div>

      <!-- PROGRESS BAR + START/NEXT -->
      <div class="progressRow">
        <div>
          <div class="barMeta">
            <div>Progress: <b id="progressText">0/2</b></div>
            <div class="timerPill" id="timer"><span>‚è≥</span><b>00:00:00</b></div>
          </div>
          <div class="bar"><span id="barFill"></span></div>
        </div>
        <button id="startBtn" class="btn"><span>üü¢</span> START</button>
      </div>

      <!-- TABLE -->
      <div class="section">
        <div class="secHead">
          <div class="secTitle">Your Keys (max 1)</div>
          <button id="newKey" class="btn secondary dim">Ôºã GET A NEW KEY</button>
        </div>
        <table>
          <thead>
            <tr>
              <th>Key</th>
              <th>Full Key</th>
              <th>Time Left</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="keysBody">
            <tr><td colspan="5" style="padding:16px;color:#a6bac1;">No keys yet.</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- ========== APP SCRIPT (‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏° API ‡∏à‡∏£‡∏¥‡∏á) ========== -->
<script>
const API = {
  getKey: async () => {
    const r = await fetch('/api/getkey', {method:'POST', headers:{'content-type':'application/json'}});
    return r.json();
  },
  check: async (key) => {
    const r = await fetch('/api/check/'+encodeURIComponent(key));
    return r.json();
  },
  extend: async (key, hours=5) => {
    const r = await fetch('/api/extend/'+encodeURIComponent(key), {
      method:'POST', headers:{'content-type':'application/json'},
      body: JSON.stringify({hours})
    });
    return r.json();
  }
};

// ---------- State ----------
const state = {
  step: 0,
  cooldownUntil: 0,
  item: JSON.parse(localStorage.getItem('ufohubx-item')||'null') // {key, expiresAt}
};
const COOLDOWN_MS = 2*60*1000;

// ---------- Helpers ----------
const $ = s=>document.querySelector(s);
const pad = n=>String(n).padStart(2,'0');
function fmtLeft(ms){
  if(ms<=0) return 'Expired';
  const s=Math.floor(ms/1000);
  const h=Math.floor(s/3600), m=Math.floor(s%3600/60), ss=s%60;
  return `${pad(h)}:${pad(m)}:${pad(ss)}`;
}
function mask(k){ return k?.length>6 ? k.slice(0,3)+'‚Ä¶'+k.slice(-3) : (k||''); }
function remainMs(exp){ return Math.max(0, exp - Date.now()); }
function setProgress(step){
  state.step = Math.max(0,Math.min(2,step));
  $('#progressText').textContent = `${state.step}/2`;
  $('#barFill').style.width = (state.step/2*100)+'%';
  paintButtons();
}

// ---------- Timer for 2 steps ----------
let tmr=null;
function runTimer(sec, after){
  clearInterval(tmr);
  const end=Date.now()+sec*1000;
  tmr=setInterval(()=>{
    const left=end-Date.now();
    $('#timer').innerHTML = `<span>‚è≥</span><b>${new Date(Math.max(0,left)).toISOString().substr(11,8)}</b>`;
    if(left<=0){ clearInterval(tmr); after&&after(); }
  },200);
}

$('#startBtn').addEventListener('click', ()=>{
  if(state.step===0){
    $('#startBtn').innerHTML='‚è±Ô∏è NEXT';
    runTimer(60, ()=>setProgress(1));       // 60s
  }else if(state.step===1){
    $('#startBtn').innerHTML='‚úÖ DONE';
    runTimer(60, ()=>{ setProgress(2); $('#startBtn').innerHTML='üü¢ START'; });
  }
});

// ---------- Render table ----------
async function paintTable(){
  const body = $('#keysBody');
  body.innerHTML='';
  if(!state.item){
    body.innerHTML = `<tr><td colspan="5" style="padding:16px;color:#a6bac1;">No keys yet.</td></tr>`;
    return;
  }
  // sync ‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å API
  try{
    const chk = await API.check(state.item.key);
    if(chk.ok){
      state.item.expiresAt = chk.expiresAt;
      localStorage.setItem('ufohubx-item', JSON.stringify(state.item));
    }
  }catch(e){/* ‡πÄ‡∏á‡∏µ‡∏¢‡∏ö‡πÑ‡∏ß‡πâ */}
  const ms = remainMs(state.item.expiresAt);

  const tr=document.createElement('tr');
  tr.innerHTML = `
    <td class="mono">${mask(state.item.key)}</td>
    <td class="mono">${state.item.key}</td>
    <td class="mono" id="leftCell">${fmtLeft(ms)}</td>
    <td>${ms>0?'<span class="badge ok">ACTIVE</span>':'<span class="badge bad">EXPIRED</span>'}</td>
    <td class="actions">
      <button class="btn secondary" id="copyBtn" style="padding:8px 12px">Copy</button>
      <button class="btn secondary" id="plusBtn" style="padding:8px 12px">+5H</button>
    </td>`;
  body.appendChild(tr);

  $('#copyBtn').addEventListener('click', async ()=>{
    try{ await navigator.clipboard.writeText(state.item.key); $('#copyBtn').textContent='‚úì Copied'; setTimeout(()=>$('#copyBtn').textContent='Copy', 900); }catch(_){}
  });
  $('#plusBtn').addEventListener('click', async ()=>{
    $('#plusBtn').textContent='‚Ä¶';
    try{
      const r = await API.extend(state.item.key, 5);
      if(r.ok){
        state.item.expiresAt = r.expiresAt;
        localStorage.setItem('ufohubx-item', JSON.stringify(state.item));
      }
    }catch(_){}
    $('#plusBtn').textContent='+5H';
    paintTable();
  });
}

function paintButtons(){
  const btn = $('#newKey');
  if(state.item){
    btn.classList.add('dim'); btn.textContent='Only 1 key per user'; return;
  }
  if(Date.now()<state.cooldownUntil){
    btn.classList.add('dim');
    btn.textContent='Wait ' + fmtLeft(state.cooldownUntil-Date.now());
    return;
  }
  if(state.step<2){
    btn.classList.add('dim'); btn.textContent='Finish START ‚Üí NEXT first'; return;
  }
  btn.classList.remove('dim'); btn.textContent='Ôºã GET A NEW KEY';
}

// ---------- Claim ----------
$('#newKey').addEventListener('click', async ()=>{
  if($('#newKey').classList.contains('dim')) return;

  $('#newKey').textContent='‚Ä¶';
  try{
    const r = await API.getKey();
    if(r.ok){
      state.item = { key:r.key, expiresAt:r.expiresAt };
      localStorage.setItem('ufohubx-item', JSON.stringify(state.item));
      state.cooldownUntil = Date.now()+COOLDOWN_MS;
      setProgress(0);
    }else{
      alert('Request failed');
    }
  }catch(e){
    alert('Network error');
  }
  paintButtons(); paintTable();
});

// ---------- Ticking ----------
setInterval(()=>{
  if(state.item){
    const cell = document.querySelector('#leftCell');
    if(cell){
      cell.textContent = fmtLeft(remainMs(state.item.expiresAt));
    }
  }
  paintButtons();
}, 1000);

// ---------- Init ----------
setProgress(state.step||0);
paintButtons();
paintTable();
</script>
</body>
</html>
